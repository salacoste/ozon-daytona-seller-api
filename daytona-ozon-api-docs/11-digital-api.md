# Digital API

API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ –≤ OZON Seller API.

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–æ–¥–æ–≤**: 4 –º–µ—Ç–æ–¥–∞ (1 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

## –û–±–∑–æ—Ä

Digital API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏:
- üì¶ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
- üîë –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–æ–≤ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–ª–∏—Ü–µ–Ω–∑–∏–∏, –∫–ª—é—á–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)
- üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- ‚è∞ –°–æ–±–ª—é–¥–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤ (24 —á–∞—Å–∞)

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π, —Ç—Ä–µ–±—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ –∏ —Å—Ç–∞—Ç—É—Å—É
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞–º–∏
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∫–æ–¥–æ–≤ (–ª–∏—Ü–µ–Ω–∑–∏–∏, –∫–ª—é—á–∏, –∫–æ–¥—ã –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–¥–æ–≤
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–æ–¥–æ–≤

### üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞–º–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –ü–∞–∫–µ—Ç–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–≤—Ü–∞–º, —Ä–∞–±–æ—Ç–∞—é—â–∏–º —Å —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
- –ö–æ–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤: 100 —Ç–æ–≤–∞—Ä–æ–≤

## –ú–µ—Ç–æ–¥—ã API

### getDigitalPostingsList()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏

```typescript
interface DigitalListPostingCodesRequest {
  dir?: 'ASC' | 'DESC';
  filter?: {
    since?: string;
    to?: string;
    cutoff_from?: string;
    cutoff_to?: string;
  };
  limit?: number;
  offset?: number;
  with?: {
    financial_data?: boolean;
    analytics_data?: boolean;
    legal_info?: boolean;
  };
}
```

### uploadDigitalCodes()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–¥—ã —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```typescript
interface DigitalUploadPostingCodesRequest {
  posting_number: string;
  exemplars_by_sku: Array<{
    sku: number;
    exemplar_qty: number;
    not_available_exemplar_qty: number;
    exemplar_keys: string[];
  }>;
}
```

### updateDigitalStocks()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

```typescript
interface DigitalStocksImportRequest {
  stocks: Array<{
    offer_id: string;
    stock: number;
  }>;
}
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
import { OzonSellerAPI } from 'bmad-ozon-seller-api';

const api = new OzonSellerAPI({
  clientId: 'your-client-id',
  apiKey: 'your-api-key'
});

// –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤
const weekAgo = new Date();
weekAgo.setDate(weekAgo.getDate() - 7);

const digitalPostings = await api.digital.getDigitalPostingsList({
  filter: {
    since: weekAgo.toISOString().split('T')[0],
    to: new Date().toISOString().split('T')[0]
  },
  limit: 100,
  with: {
    financial_data: true,
    analytics_data: true
  }
});

// –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–¥—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
await api.digital.uploadDigitalCodes({
  posting_number: '12345-0001-1',
  exemplars_by_sku: [{
    sku: 123456789,
    exemplar_qty: 3,
    not_available_exemplar_qty: 0,
    exemplar_keys: [
      'GAME_KEY_001_ABC123',
      'GAME_KEY_002_DEF456', 
      'GAME_KEY_003_GHI789'
    ]
  }]
});

// –û–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
await api.digital.updateDigitalStocks({
  stocks: [
    {
      offer_id: 'GAME_DIGITAL_001',
      stock: 50
    },
    {
      offer_id: 'SOFTWARE_LICENSE_002', 
      stock: 25
    }
  ]
});
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### –ú–µ–Ω–µ–¥–∂–µ—Ä —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤

```typescript
class DigitalOrderManager {
  constructor(private api: OzonSellerAPI) {}

  async processDigitalOrders(): Promise<void> {
    // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã, –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤
    const pendingOrders = await this.api.digital.getDigitalPostingsList({
      filter: {
        since: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
      },
      limit: 1000,
      with: {
        analytics_data: true,
        financial_data: true
      }
    });

    const ordersNeedingCodes = pendingOrders.result?.filter(posting => 
      posting.status === 'awaiting_packaging' &&
      posting.products?.some(product => product.required_qty_for_digital_code > 0)
    ) || [];

    console.log(`–ù–∞–π–¥–µ–Ω–æ ${ordersNeedingCodes.length} –∑–∞–∫–∞–∑–æ–≤, —Ç—Ä–µ–±—É—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤`);

    for (const order of ordersNeedingCodes) {
      await this.uploadCodesForOrder(order);
      
      // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–∫–∞–∑–æ–≤
      await new Promise(resolve => setTimeout(resolve, 500));
    }
  }

  private async uploadCodesForOrder(order: any): Promise<void> {
    try {
      const codesByProduct = [];
      
      for (const product of order.products || []) {
        if (product.required_qty_for_digital_code > 0) {
          const codes = await this.generateCodesForProduct(
            product.sku, 
            product.required_qty_for_digital_code
          );
          
          codesByProduct.push({
            sku: product.sku,
            exemplar_qty: codes.length,
            not_available_exemplar_qty: 0,
            exemplar_keys: codes
          });
        }
      }

      if (codesByProduct.length > 0) {
        const result = await this.api.digital.uploadDigitalCodes({
          posting_number: order.posting_number,
          exemplars_by_sku: codesByProduct
        });

        this.validateUploadResults(order.posting_number, result);
      }
    } catch (error) {
      console.error(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ ${order.posting_number}:`, error);
    }
  }

  private async generateCodesForProduct(sku: number, quantity: number): Promise<string[]> {
    // –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–æ–≤ –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã
    const codes: string[] = [];
    
    for (let i = 0; i < quantity; i++) {
      codes.push(`${sku}_KEY_${Date.now()}_${Math.random().toString(36).substring(7).toUpperCase()}`);
    }
    
    return codes;
  }

  private validateUploadResults(postingNumber: string, result: any): void {
    let totalReceived = 0;
    let totalRejected = 0;

    result.exemplars_by_sku?.forEach((skuResult: any) => {
      totalReceived += skuResult.received_qty || 0;
      totalRejected += skuResult.rejected_qty || 0;
      
      if (skuResult.failed_exemplars?.length > 0) {
        console.warn(`–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è SKU ${skuResult.sku} –≤ –∑–∞–∫–∞–∑–µ ${postingNumber}:`);
        skuResult.failed_exemplars.forEach((error: any) => {
          console.warn(`  ${error.code}: ${error.message}`);
        });
      }
    });

    console.log(`–ó–∞–∫–∞–∑ ${postingNumber}: –ø—Ä–∏–Ω—è—Ç–æ –∫–æ–¥–æ–≤ ${totalReceived}, –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ ${totalRejected}`);
  }
}
```

#### –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤

```typescript
class DigitalStockMonitor {
  constructor(
    private api: OzonSellerAPI,
    private lowStockThreshold: number = 10
  ) {}

  async monitorAndUpdateStocks(): Promise<void> {
    // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã
    const stockData = await this.getExternalStockData();
    
    // –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä—ã —Å –Ω–∏–∑–∫–∏–º–∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏
    const lowStockItems = stockData.filter(item => item.availableStock <= this.lowStockThreshold);
    
    if (lowStockItems.length > 0) {
      console.warn(`–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${lowStockItems.length} —Ç–æ–≤–∞—Ä–æ–≤ —Å –Ω–∏–∑–∫–∏–º–∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏`);
      await this.sendLowStockAlert(lowStockItems);
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ –≤ OZON
    await this.updateStocksBatch(stockData);
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ –æ—Å—Ç–∞—Ç–∫–∞–º
    await this.generateStockReport(stockData);
  }

  private async updateStocksBatch(stockData: any[]): Promise<void> {
    const batchSize = 100;
    let successCount = 0;
    let errorCount = 0;
    
    for (let i = 0; i < stockData.length; i += batchSize) {
      const batch = stockData.slice(i, i + batchSize);
      
      try {
        const result = await this.api.digital.updateDigitalStocks({
          stocks: batch.map(item => ({
            offer_id: item.offerId,
            stock: item.availableStock
          }))
        });
        
        // –ü–æ–¥—Å—á–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        result.status?.forEach(status => {
          if (status.updated) {
            successCount++;
          } else {
            errorCount++;
            console.error(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ${status.offer_id}:`, status.errors);
          }
        });
        
        console.log(`–û–±—Ä–∞–±–æ—Ç–∞–Ω –±–∞—Ç—á ${Math.floor(i / batchSize) + 1}/${Math.ceil(stockData.length / batchSize)}`);
        
        // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
        if (i + batchSize < stockData.length) {
          await new Promise(resolve => setTimeout(resolve, 1000));
        }
      } catch (error) {
        console.error(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞—Ç—á–∞:`, error);
        errorCount += batch.length;
      }
    }
    
    console.log(`–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: —É—Å–ø–µ—à–Ω–æ ${successCount}, –æ—à–∏–±–æ–∫ ${errorCount}`);
  }

  private async getExternalStockData(): Promise<any[]> {
    // –≠–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã
    return [
      { offerId: 'GAME_DIGITAL_001', availableStock: 50 },
      { offerId: 'SOFTWARE_LICENSE_002', availableStock: 5 }, // –ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫
      { offerId: 'DIGITAL_BOOK_003', availableStock: 100 },
      { offerId: 'MUSIC_ALBUM_004', availableStock: 2 }, // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫
    ];
  }

  private async sendLowStockAlert(lowStockItems: any[]): Promise<void> {
    // –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–∏–∑–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–∞—Ö
    console.log('üö® –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∏–∑–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–∞—Ö:');
    lowStockItems.forEach(item => {
      const severity = item.availableStock <= 5 ? 'üî¥ –ö–†–ò–¢–ò–ß–ù–û' : 'üü° –í–ù–ò–ú–ê–ù–ò–ï';
      console.log(`${severity} ${item.offerId}: ${item.availableStock} —à—Ç.`);
    });
  }

  private async generateStockReport(stockData: any[]): Promise<void> {
    const totalItems = stockData.length;
    const totalStock = stockData.reduce((sum, item) => sum + item.availableStock, 0);
    const avgStock = Math.round(totalStock / totalItems);
    const lowStockCount = stockData.filter(item => item.availableStock <= this.lowStockThreshold).length;
    
    console.log('\nüìä –û—Ç—á–µ—Ç –ø–æ –æ—Å—Ç–∞—Ç–∫–∞–º —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤:');
    console.log(`–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: ${totalItems}`);
    console.log(`–û–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫: ${totalStock} —à—Ç.`);
    console.log(`–°—Ä–µ–¥–Ω–∏–π –æ—Å—Ç–∞—Ç–æ–∫: ${avgStock} —à—Ç.`);
    console.log(`–¢–æ–≤–∞—Ä–æ–≤ —Å –Ω–∏–∑–∫–∏–º –æ—Å—Ç–∞—Ç–∫–æ–º: ${lowStockCount} (${Math.round(lowStockCount / totalItems * 100)}%)`);
  }
}
```

#### –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏

```typescript
class DigitalAnalyticsReporter {
  constructor(private api: OzonSellerAPI) {}

  async generateDigitalSalesReport(dateFrom: string, dateTo: string): Promise<void> {
    const digitalPostings = await this.api.digital.getDigitalPostingsList({
      filter: {
        since: dateFrom,
        to: dateTo
      },
      limit: 1000,
      with: {
        financial_data: true,
        analytics_data: true
      }
    });

    const analytics = this.analyzeDigitalSales(digitalPostings.result || []);
    this.generateReport(analytics, dateFrom, dateTo);
  }

  private analyzeDigitalSales(postings: any[]): any {
    const analytics = {
      totalOrders: postings.length,
      totalRevenue: 0,
      totalCommission: 0,
      productStats: new Map(),
      regionStats: new Map(),
      statusStats: new Map(),
      codeUploadStats: {
        totalRequired: 0,
        uploaded: 0,
        pending: 0
      }
    };

    postings.forEach(posting => {
      // –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
      if (posting.financial_data) {
        analytics.totalRevenue += posting.financial_data.order_amount || 0;
        analytics.totalCommission += posting.financial_data.commission || 0;
      }

      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
      const currentCount = analytics.statusStats.get(posting.status) || 0;
      analytics.statusStats.set(posting.status, currentCount + 1);

      // –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
      if (posting.analytics_data?.region) {
        const regionCount = analytics.regionStats.get(posting.analytics_data.region) || 0;
        analytics.regionStats.set(posting.analytics_data.region, regionCount + 1);
      }

      // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º –∏ –∫–æ–¥–∞–º
      posting.products?.forEach((product: any) => {
        const sku = product.sku.toString();
        if (!analytics.productStats.has(sku)) {
          analytics.productStats.set(sku, {
            name: product.name,
            totalSold: 0,
            totalRevenue: 0,
            codesRequired: 0
          });
        }

        const productStat = analytics.productStats.get(sku);
        productStat.totalSold += product.quantity;
        productStat.totalRevenue += (product.price || 0) * product.quantity;
        productStat.codesRequired += product.required_qty_for_digital_code || 0;

        analytics.codeUploadStats.totalRequired += product.required_qty_for_digital_code || 0;
        
        if (product.required_qty_for_digital_code > 0 && posting.status === 'awaiting_packaging') {
          analytics.codeUploadStats.pending += product.required_qty_for_digital_code;
        } else if (product.required_qty_for_digital_code > 0) {
          analytics.codeUploadStats.uploaded += product.required_qty_for_digital_code;
        }
      });
    });

    return analytics;
  }

  private generateReport(analytics: any, dateFrom: string, dateTo: string): void {
    console.log(`\nüìà –û—Ç—á–µ—Ç –ø–æ —Ü–∏—Ñ—Ä–æ–≤—ã–º —Ç–æ–≤–∞—Ä–∞–º (${dateFrom} - ${dateTo})`);
    console.log('='.repeat(60));
    
    // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    console.log('\nüìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:');
    console.log(`–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: ${analytics.totalOrders}`);
    console.log(`–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞: ${analytics.totalRevenue.toFixed(2)} —Ä—É–±.`);
    console.log(`–û–±—â–∞—è –∫–æ–º–∏—Å—Å–∏—è: ${analytics.totalCommission.toFixed(2)} —Ä—É–±.`);
    console.log(`–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: ${(analytics.totalRevenue - analytics.totalCommission).toFixed(2)} —Ä—É–±.`);
    console.log(`–°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ${(analytics.totalRevenue / analytics.totalOrders).toFixed(2)} —Ä—É–±.`);

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–æ–¥–∞–º
    console.log('\nüîë –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–æ–¥–∞–º:');
    console.log(`–í—Å–µ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–¥–æ–≤: ${analytics.codeUploadStats.totalRequired}`);
    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–æ–¥–æ–≤: ${analytics.codeUploadStats.uploaded}`);
    console.log(`–û–∂–∏–¥–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏: ${analytics.codeUploadStats.pending}`);
    
    if (analytics.codeUploadStats.totalRequired > 0) {
      const uploadRate = (analytics.codeUploadStats.uploaded / analytics.codeUploadStats.totalRequired * 100).toFixed(1);
      console.log(`–ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏: ${uploadRate}%`);
    }

    // –¢–æ–ø —Ç–æ–≤–∞—Ä—ã
    console.log('\nüèÜ –¢–æ–ø-5 —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º:');
    const topProducts = Array.from(analytics.productStats.entries())
      .sort(([,a], [,b]) => b.totalRevenue - a.totalRevenue)
      .slice(0, 5);
      
    topProducts.forEach(([sku, stats], index) => {
      console.log(`${index + 1}. ${stats.name} (SKU: ${sku})`);
      console.log(`   –ü—Ä–æ–¥–∞–Ω–æ: ${stats.totalSold} —à—Ç., –í—ã—Ä—É—á–∫–∞: ${stats.totalRevenue.toFixed(2)} —Ä—É–±.`);
    });

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
    if (analytics.regionStats.size > 0) {
      console.log('\nüåç –¢–æ–ø-5 —Ä–µ–≥–∏–æ–Ω–æ–≤:');
      const topRegions = Array.from(analytics.regionStats.entries())
        .sort(([,a], [,b]) => b - a)
        .slice(0, 5);
        
      topRegions.forEach(([region, count], index) => {
        const percentage = (count / analytics.totalOrders * 100).toFixed(1);
        console.log(`${index + 1}. ${region}: ${count} –∑–∞–∫–∞–∑–æ–≤ (${percentage}%)`);
      });
    }

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
    console.log('\nüì¶ –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤:');
    Array.from(analytics.statusStats.entries()).forEach(([status, count]) => {
      const percentage = (count / analytics.totalOrders * 100).toFixed(1);
      console.log(`${status}: ${count} –∑–∞–∫–∞–∑–æ–≤ (${percentage}%)`);
    });
  }
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```typescript
try {
  await api.digital.uploadDigitalCodes({
    posting_number: '12345-0001-1',
    exemplars_by_sku: [/* ... */]
  });
} catch (error) {
  if (error.response?.status === 400) {
    console.error('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error.response.data);
  } else if (error.response?.status === 403) {
    console.error('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ü–∏—Ñ—Ä–æ–≤—ã–º —Ç–æ–≤–∞—Ä–∞–º');
  } else if (error.response?.status === 404) {
    console.error('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
  } else {
    console.error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:', error.message);
  }
}
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### üéØ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–∫–µ—Ç–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ (–¥–æ 100 —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ –∑–∞–ø—Ä–æ—Å)
- –î–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è rate limiting
- –ö–µ—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å  
- –•—Ä–∞–Ω–∏—Ç–µ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –∫–æ–¥—ã –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
- –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–¥–∞–º–∏ –¥–ª—è –∞—É–¥–∏—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏ —Å–ª–æ–∂–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –¥–µ–¥–ª–∞–π–Ω—ã –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤ (24 —á–∞—Å–∞)
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –Ω–∏–∑–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –∫–æ–¥–æ–≤

### üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∏–∑–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–∞—Ö
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏

Digital API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏, –æ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é —Ä–∞–±–æ—Ç—É —Å —Ü–∏—Ñ—Ä–æ–≤—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ OZON.