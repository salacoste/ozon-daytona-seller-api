# üì¶ Products API - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤

**–°–∞–º–∞—è –≤–∞–∂–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è OZON Seller API** –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤ –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è.

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ API

Products API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è:
- **–°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏–º–ø–æ—Ä—Ç** —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥ OZON
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏** –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
- **–ö–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–Ω –∏ –æ—Å—Ç–∞—Ç–∫–æ–≤** –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö
- **–†–∞–±–æ—Ç–∞ —Å –º–µ–¥–∏–∞** (—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏, –≤–∏–¥–µ–æ, 360¬∞ –æ–±–∑–æ—Ä—ã)
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏** –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- **–ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤
- **–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏** –ø–æ —Ç–æ–≤–∞—Ä–∞–º –∏ –ø—Ä–æ–¥–∞–∂–∞–º

---

## üìã –°–ø–∏—Å–æ–∫ –º–µ—Ç–æ–¥–æ–≤ (34 endpoint'–∞)

### üèóÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤
| –ú–µ—Ç–æ–¥ | Endpoint | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|---------|------------|
| `create` | `/v2/product/import` | v2 | –°–æ–∑–¥–∞–Ω–∏–µ/–∏–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ |
| `importBySKU` | `/v1/product/import-by-sku` | v1 | –ò–º–ø–æ—Ä—Ç –ø–æ –∞—Ä—Ç–∏–∫—É–ª–∞–º –ø—Ä–æ–¥–∞–≤—Ü–∞ |

### üìä –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–∞—Ö
| –ú–µ—Ç–æ–¥ | Endpoint | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|---------|------------|
| `getList` | `/v2/product/list` | v2 | –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ |
| `getListV3` | `/v3/product/list` | v3 | –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ |
| `getInfo` | `/v2/product/info` | v2 | –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö |
| `getInfoV3` | `/v3/product/info` | v3 | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (v3) |
| `getDescription` | `/v1/product/info/description` | v1 | –û–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ |
| `getSubscription` | `/v1/product/info/subscription` | v1 | –ü–æ–¥–ø–∏—Å–æ—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã |

### üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ –∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏
| –ú–µ—Ç–æ–¥ | Endpoint | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|---------|------------|
| `updatePrices` | `/v1/product/import/prices` | v1 | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω |
| `updateStocks` | `/v1/product/import/stocks` | v1 | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ |
| `getPrices` | `/v4/product/info/prices` | v4 | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω —Ç–æ–≤–∞—Ä–æ–≤ |
| `getStocks` | `/v3/product/info/stocks` | v3 | –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
```typescript
import { OzonSellerAPI } from 'daytona-ozon-seller-api';

const client = new OzonSellerAPI({
  clientId: 'your-client-id',
  apiKey: 'your-api-key'
});
```

### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
```typescript
try {
  const result = await client.products.getList({
    filter: {
      offer_id: ['SKU-001', 'SKU-002'], // –í–∞—à–∏ –∞—Ä—Ç–∏–∫—É–ª—ã
      product_id: [], // –ò–ª–∏ OZON Product ID
      visibility: 'ALL'
    },
    limit: 100,
    last_id: '', // –î–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    sort_dir: 'ASC'
  });

  console.log(`üì¶ –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ${result.result?.items?.length || 0}`);
  console.log(`üîÑ –ï—Å—Ç—å –µ—â—ë: ${result.result?.has_next ? '–î–∞' : '–ù–µ—Ç'}`);
  
  result.result?.items?.forEach(item => {
    console.log(`- ${item.offer_id}: ${item.name} (${item.status?.state})`);
  });
} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤:', error);
}
```

#### 2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
```typescript
try {
  const newProduct = await client.products.create({
    items: [{
      name: '–°–º–∞—Ä—Ç—Ñ–æ–Ω Apple iPhone 15 Pro 256GB',
      offer_id: 'IPHONE-15-PRO-256', // –í–∞—à —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∞—Ä—Ç–∏–∫—É–ª
      category_id: 17033631, // ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ OZON
      price: '89990',
      old_price: '99990',
      premium_price: '87990',
      vat: '0.2', // –ù–î–° 20%
      height: 147,
      width: 71,
      depth: 8,
      weight: 187,
      images: [{
        file_name: 'main.jpg',
        default: true
      }],
      attributes: [{
        complex_id: 0,
        id: 85, // ID –∞—Ç—Ä–∏–±—É—Ç–∞ "–ë—Ä–µ–Ω–¥"
        values: [{
          dictionary_value_id: 971082156,
          value: 'Apple'
        }]
      }]
    }]
  });

  console.log('‚úÖ –¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ');
  console.log(`üìù Task ID: ${newProduct.result?.task_id}`);
} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:', error);
}
```

#### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω
```typescript
try {
  const priceUpdate = await client.products.updatePrices({
    prices: [{
      offer_id: 'SKU-001',
      price: '15990',
      old_price: '19990',
      premium_price: '14990',
      currency_code: 'RUB'
    }, {
      offer_id: 'SKU-002', 
      price: '7500',
      currency_code: 'RUB'
    }]
  });

  console.log('üí∞ –¶–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
  console.log(`üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: ${priceUpdate.result?.length} —Ç–æ–≤–∞—Ä–æ–≤`);
} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω:', error);
}
```

#### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤
```typescript
try {
  const stockUpdate = await client.products.updateStocks({
    stocks: [{
      offer_id: 'SKU-001',
      stock: 50, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ
      warehouse_id: 123456789
    }, {
      offer_id: 'SKU-002',
      stock: 0, // –¢–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è
      warehouse_id: 123456789
    }]
  });

  console.log('üì¶ –û—Å—Ç–∞—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
  console.log(`üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: ${stockUpdate.result?.length} —Ç–æ–≤–∞—Ä–æ–≤`);
} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤:', error);
}
```

---

## üéØ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üìä –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞

**–ó–∞–¥–∞—á–∞**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥ —Å OZON (—Ü–µ–Ω—ã, –æ—Å—Ç–∞—Ç–∫–∏, –æ–ø–∏—Å–∞–Ω–∏—è)

```typescript
async function syncCatalogWithOzon() {
  console.log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∫–∞—Ç–∞–ª–æ–≥–∞...');
  
  try {
    // 1. –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ OZON
    const existingProducts = new Map();
    let lastId = '';
    
    do {
      const batch = await client.products.getList({
        filter: { visibility: 'ALL' },
        limit: 1000,
        last_id: lastId
      });
      
      batch.result?.items?.forEach(item => {
        if (item.offer_id) {
          existingProducts.set(item.offer_id, item);
        }
      });
      
      lastId = batch.result?.last_id || '';
      console.log(`üì• –ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${existingProducts.size} —Ç–æ–≤–∞—Ä–æ–≤`);
      
    } while (lastId);
    
    // 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã
    const externalProducts = await getProductsFromExternalSystem();
    console.log(`üóÉÔ∏è –í–Ω–µ—à–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥: ${externalProducts.length} —Ç–æ–≤–∞—Ä–æ–≤`);
    
    // 3. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    const toUpdate = [];
    const toCreate = [];
    
    for (const extProduct of externalProducts) {
      const existing = existingProducts.get(extProduct.sku);
      
      if (existing) {
        // –¢–æ–≤–∞—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if (needsUpdate(existing, extProduct)) {
          toUpdate.push(extProduct);
        }
      } else {
        // –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä
        toCreate.push(extProduct);
      }
    }
    
    console.log(`‚ûï –°–æ–∑–¥–∞—Ç—å: ${toCreate.length} —Ç–æ–≤–∞—Ä–æ–≤`);
    console.log(`üîÑ –û–±–Ω–æ–≤–∏—Ç—å: ${toUpdate.length} —Ç–æ–≤–∞—Ä–æ–≤`);
    
    // 4. –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
    if (toCreate.length > 0) {
      const createResult = await client.products.create({
        items: toCreate.map(product => mapToOzonProduct(product))
      });
      console.log(`‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ: Task ID ${createResult.result?.task_id}`);
    }
    
    // 5. –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã
    if (toUpdate.length > 0) {
      const prices = toUpdate.map(product => ({
        offer_id: product.sku,
        price: product.price.toString(),
        old_price: product.oldPrice?.toString(),
        currency_code: 'RUB'
      }));
      
      await client.products.updatePrices({ prices });
      console.log(`üí∞ –¶–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã: ${prices.length} —Ç–æ–≤–∞—Ä–æ–≤`);
    }
    
    // 6. –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–∫–∏
    const stocks = externalProducts.map(product => ({
      offer_id: product.sku,
      stock: product.quantity,
      warehouse_id: DEFAULT_WAREHOUSE_ID
    }));
    
    await client.products.updateStocks({ stocks });
    console.log(`üì¶ –û—Å—Ç–∞—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã: ${stocks.length} —Ç–æ–≤–∞—Ä–æ–≤`);
    
    console.log('‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
    throw error;
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function needsUpdate(existing: any, external: any): boolean {
  return (
    existing.price !== external.price.toString() ||
    existing.name !== external.name ||
    existing.primary_image !== external.image
  );
}

function mapToOzonProduct(product: any) {
  return {
    name: product.name,
    offer_id: product.sku,
    category_id: product.categoryId,
    price: product.price.toString(),
    old_price: product.oldPrice?.toString(),
    images: product.images?.map((img: string, index: number) => ({
      file_name: `image_${index}.jpg`,
      default: index === 0
    })) || [],
    attributes: mapAttributes(product.attributes)
  };
}
```

### üîç –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

**–ó–∞–¥–∞—á–∞**: –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```typescript
async function monitorModerationStatus() {
  console.log('üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏...');
  
  try {
    // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –º–æ–¥–µ—Ä–∞—Ü–∏–∏
    const moderationItems = await client.products.getList({
      filter: {
        visibility: 'ALL'
      },
      limit: 1000
    });
    
    const statusCounts = new Map();
    const problemItems = [];
    
    moderationItems.result?.items?.forEach(item => {
      const state = item.status?.state;
      const moderationState = item.status?.moderation_status;
      
      // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å—ã
      statusCounts.set(state, (statusCounts.get(state) || 0) + 1);
      
      // –ò—â–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
      if (state === 'FAILED_MODERATION' || 
          state === 'FAILED_VALIDATION' ||
          moderationState === 'DECLINED') {
        problemItems.push({
          offer_id: item.offer_id,
          name: item.name,
          state: state,
          moderation_status: moderationState,
          errors: item.status?.item_errors || []
        });
      }
    });
    
    // –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    console.log('\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º:');
    for (const [status, count] of statusCounts) {
      console.log(`  ${getStatusEmoji(status)} ${status}: ${count} —Ç–æ–≤–∞—Ä–æ–≤`);
    }
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
    if (problemItems.length > 0) {
      console.log(`\n‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ ${problemItems.length} –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤:`);
      
      for (const item of problemItems) {
        console.log(`\n‚ùå ${item.offer_id}: ${item.name}`);
        console.log(`   –°—Ç–∞—Ç—É—Å: ${item.state}`);
        
        if (item.errors?.length > 0) {
          console.log('   –û—à–∏–±–∫–∏:');
          item.errors.forEach((error: any) => {
            console.log(`   - ${error.code}: ${error.message}`);
          });
        }
      }
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      await sendModerationAlerts(problemItems);
    }
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:', error);
  }
}

function getStatusEmoji(status: string): string {
  const statusEmojis: { [key: string]: string } = {
    'PROCESSED': '‚úÖ',
    'PROCESSING': 'üîÑ',
    'FAILED_MODERATION': '‚ùå',
    'FAILED_VALIDATION': '‚ö†Ô∏è',
    'ARCHIVED': 'üì¶'
  };
  return statusEmojis[status] || '‚ùì';
}
```

### üìà –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú–∞—Å—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ —Å —É—á—ë—Ç–æ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤

```typescript
async function updatePricesWithCompetitorAnalysis() {
  console.log('üí∞ –ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...');
  
  try {
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã –Ω–∞—à–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
    const ourProducts = await client.products.getList({
      filter: { visibility: 'VISIBLE' },
      limit: 1000
    });
    
    const priceUpdates = [];
    
    for (const item of ourProducts.result?.items || []) {
      if (!item.offer_id) continue;
      
      // –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ
      const productInfo = await client.products.getInfo({
        offer_id: item.offer_id
      });
      
      const currentPrice = parseFloat(productInfo.result?.price || '0');
      const competitorPrice = await getCompetitorPrice(item.offer_id);
      
      if (competitorPrice > 0) {
        // –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è: –Ω–∞ 5% –Ω–∏–∂–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
        const newPrice = Math.round(competitorPrice * 0.95);
        const priceChange = ((newPrice - currentPrice) / currentPrice) * 100;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ (>2%)
        if (Math.abs(priceChange) > 2) {
          priceUpdates.push({
            offer_id: item.offer_id,
            price: newPrice.toString(),
            old_price: currentPrice.toString(),
            currency_code: 'RUB'
          });
          
          console.log(`üìä ${item.offer_id}: ${currentPrice}‚ÇΩ ‚Üí ${newPrice}‚ÇΩ (${priceChange > 0 ? '+' : ''}${priceChange.toFixed(1)}%)`);
        }
      }
    }
    
    // –ë–∞—Ç—á–µ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω
    if (priceUpdates.length > 0) {
      const batchSize = 100;
      
      for (let i = 0; i < priceUpdates.length; i += batchSize) {
        const batch = priceUpdates.slice(i, i + batchSize);
        
        await client.products.updatePrices({
          prices: batch
        });
        
        console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ü–µ–Ω: ${i + batch.length}/${priceUpdates.length}`);
        
        // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
    }
    
    console.log(`üí∞ –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${priceUpdates.length} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ`);
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω:', error);
  }
}
```

---

## üìù TypeScript —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ Request –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
interface ProductImportRequest {
  items: ProductImportItem[];
}

interface ProductImportItem {
  name: string;
  offer_id: string;
  category_id: number;
  price?: string;
  old_price?: string;
  premium_price?: string;
  vat?: string;
  height?: number;
  width?: number;
  depth?: number;
  weight?: number;
  images?: ProductImage[];
  attributes?: ProductAttribute[];
  pdf_list?: ProductPdf[];
  complex_attributes?: ProductComplexAttribute[];
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
interface ProductListRequest {
  filter?: ProductListFilter;
  limit?: number;
  last_id?: string;
  sort_dir?: 'ASC' | 'DESC';
}

interface ProductListFilter {
  offer_id?: string[];
  product_id?: number[];
  visibility?: 'ALL' | 'VISIBLE' | 'INVISIBLE' | 'EMPTY_STOCK' | 
              'NOT_MODERATED' | 'MODERATED' | 'DISABLED' | 'STATE_FAILED_MODERATION' |
              'READY_TO_SUPPLY' | 'VALIDATION_STATE_PENDING' | 'VALIDATION_STATE_FAIL' |
              'VALIDATION_STATE_SUCCESS' | 'TO_SUPPLY' | 'IN_SALE' | 'REMOVED_FROM_SALE' |
              'BANNED' | 'OVERPRICED' | 'CRITICALLY_OVERPRICED' | 'EMPTY_BARCODE' |
              'BARCODE_EXISTS' | 'QUARANTINE' | 'ARCHIVED' | 'OVERPRICED_WITH_STOCK' |
              'PARTIAL_APPROVED' | 'IMAGE_ABSENT' | 'MODERATION_BLOCK';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω
interface ProductPricesImportRequest {
  prices: ProductPrice[];
}

interface ProductPrice {
  offer_id?: string;
  product_id?: number;
  price: string;
  old_price?: string;
  premium_price?: string;
  currency_code?: string;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤
interface ProductStocksImportRequest {
  stocks: ProductStock[];
}

interface ProductStock {
  offer_id?: string;
  product_id?: number;
  stock: number;
  warehouse_id: number;
}

### Response –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
interface ProductImportResponse {
  result?: {
    task_id?: number;
  };
}

// –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
interface ProductListResponse {
  result?: {
    items?: ProductListItem[];
    total?: number;
    last_id?: string;
    has_next?: boolean;
  };
}

interface ProductListItem {
  product_id?: number;
  offer_id?: string;
  is_fbo_visible?: boolean;
  is_fbs_visible?: boolean;
  archived?: boolean;
  is_discounted?: boolean;
  name?: string;
  primary_image?: string;
  status?: ProductStatus;
  errors?: ProductError[];
  vat?: string;
  visible?: boolean;
  buybox_price?: string;
  created_at?: string;
  updated_at?: string;
}

interface ProductStatus {
  state?: 'NEW' | 'PENDING' | 'FAILED_MODERATION' | 'FAILED_VALIDATION' | 
          'PROCESSED' | 'PROCESSING' | 'REMOVED_FROM_PUBLICATION' | 'ARCHIVED';
  state_failed?: string;
  moderate_status?: string;
  decline_reasons?: string[];
  validation_state?: 'NEW' | 'PENDING' | 'FAIL' | 'SUCCESS';
  state_name?: string;
  state_description?: string;
  is_failed?: boolean;
  is_created?: boolean;
  state_tooltip?: string;
  item_errors?: ProductError[];
  state_updated_at?: string;
}

// –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö
interface ProductInfoResponse {
  result?: {
    items?: ProductInfoItem[];
  };
}

interface ProductInfoItem {
  id?: number;
  name?: string;
  offer_id?: string;
  barcode?: string;
  category_id?: number;
  created_at?: string;
  images?: ProductImage[];
  marketing_price?: string;
  min_price?: string;
  old_price?: string;
  premium_price?: string;
  price?: string;
  recommended_price?: string;
  sources?: ProductSource[];
  state?: string;
  stocks?: ProductStockInfo;
  errors?: ProductError[];
  vat?: string;
  visible?: boolean;
  visibility_details?: ProductVisibilityDetails;
  price_index?: string;
  images360?: ProductImage360[];
  color_image?: string;
  primary_image?: string;
  status?: ProductStatus;
}

// –¶–µ–Ω—ã —Ç–æ–≤–∞—Ä–æ–≤
interface ProductPricesResponse {
  result?: {
    items?: ProductPriceItem[];
  };
}

interface ProductPriceItem {
  product_id?: number;
  offer_id?: string;
  price?: ProductPriceDetails;
  price_indexes?: ProductPriceIndexes;
  commissions?: ProductCommissions;
  volume_weight?: number;
  currency_code?: string;
  marketing_seller_price?: string;
  min_ozon_price?: string;
  min_price?: string;
}
```

---

## üö® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ API –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –õ–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **Rate Limits**: –î–æ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
- **Batch Size**: –ú–∞–∫—Å–∏–º—É–º 100 —Ç–æ–≤–∞—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å–æ–∑–¥–∞–Ω–∏—è
- **Pagination**: –ú–∞–∫—Å–∏–º—É–º 1000 —Ç–æ–≤–∞—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å–ø–∏—Å–∫–∞

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
const createResult = await client.products.create({ items: [...] });
const taskId = createResult.result?.task_id;

if (taskId) {
  // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
  let taskStatus;
  do {
    await new Promise(resolve => setTimeout(resolve, 5000)); // 5 —Å–µ–∫—É–Ω–¥
    taskStatus = await client.products.getImportInfo({ task_id: taskId });
    
    console.log(`üîÑ –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏: ${taskStatus.result?.state}`);
  } while (taskStatus.result?.state === 'pending');
  
  console.log(`‚úÖ –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${taskStatus.result?.state}`);
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
const products = await client.products.getList({ filter: { visibility: 'ALL' } });

products.result?.items?.forEach(item => {
  if (item.status?.is_failed) {
    console.log(`‚ùå –¢–æ–≤–∞—Ä ${item.offer_id} –æ—Ç–∫–ª–æ–Ω—ë–Ω:`);
    
    item.status?.item_errors?.forEach(error => {
      console.log(`  - ${error.code}: ${error.message}`);
      
      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏
      switch (error.code) {
        case 'PRODUCT_SAME_NAME_AND_CATEGORY':
          console.log('  ‚ö†Ô∏è –†–µ—à–µ–Ω–∏–µ: –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞');
          break;
        case 'PRODUCT_INVALID_PRICE':
          console.log('  ‚ö†Ô∏è –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ü–µ–Ω—ã');
          break;
        case 'PRODUCT_ATTRIBUTE_VALUE_MISSING':
          console.log('  ‚ö†Ô∏è –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤—å—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã');
          break;
      }
    });
  }
});
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
```typescript
// –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤
const productAttributes = [
  {
    complex_id: 0, // –ë–∞–∑–æ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
    id: 85, // ID –∞—Ç—Ä–∏–±—É—Ç–∞ "–ë—Ä–µ–Ω–¥"
    values: [{
      dictionary_value_id: 971082156, // ID –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ OZON
      value: 'Apple'
    }]
  },
  {
    complex_id: 0,
    id: 9048, // –¶–≤–µ—Ç —Ç–æ–≤–∞—Ä–∞
    values: [{
      value: '–ß—ë—Ä–Ω—ã–π' // –°–≤–æ–±–æ–¥–Ω—ã–π –≤–≤–æ–¥
    }]
  }
];
```

---

## üí° –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
```typescript
// ‚úÖ –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
async function batchUpdatePrices(prices: ProductPrice[]) {
  const batchSize = 100;
  const results = [];
  
  for (let i = 0; i < prices.length; i += batchSize) {
    const batch = prices.slice(i, i + batchSize);
    
    try {
      const result = await client.products.updatePrices({ prices: batch });
      results.push(result);
      
      console.log(`‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${i + batch.length}/${prices.length}`);
      
      // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
      if (i + batchSize < prices.length) {
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
    } catch (error) {
      console.error(`‚ùå –û—à–∏–±–∫–∞ –≤ –±–∞—Ç—á–µ ${i}-${i + batch.length}:`, error);
    }
  }
  
  return results;
}
```

### 2. –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
```typescript
// ‚úÖ Retry –ª–æ–≥–∏–∫–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
async function reliableApiCall<T>(
  operation: () => Promise<T>,
  maxRetries = 3
): Promise<T> {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await operation();
    } catch (error: any) {
      if (attempt === maxRetries) throw error;
      
      const isRetryable = error.status >= 500 || error.code === 'NETWORK_ERROR';
      if (!isRetryable) throw error;
      
      const delay = Math.pow(2, attempt) * 1000; // 2s, 4s, 8s
      console.log(`‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ ${attempt} –Ω–µ —É–¥–∞–ª–∞—Å—å, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${delay}–º—Å`);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
  
  throw new Error('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –∏—Å—á–µ—Ä–ø–∞–Ω–æ');
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const products = await reliableApiCall(() => 
  client.products.getList({ filter: { visibility: 'VISIBLE' } })
);
```

### 3. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
```typescript
class ProductCache {
  private cache = new Map<string, { data: any; timestamp: number }>();
  private readonly TTL = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
  
  async getProductInfo(offerId: string) {
    const cached = this.cache.get(offerId);
    
    if (cached && (Date.now() - cached.timestamp) < this.TTL) {
      return cached.data;
    }
    
    const data = await client.products.getInfo({ offer_id: offerId });
    this.cache.set(offerId, { data, timestamp: Date.now() });
    
    return data;
  }
  
  clear() {
    this.cache.clear();
  }
}
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```typescript
class ProductManager {
  private metrics = {
    created: 0,
    updated: 0,
    failed: 0,
    errors: [] as Array<{ offerId: string; error: string }>
  };
  
  async createProduct(item: ProductImportItem) {
    try {
      const result = await client.products.create({ items: [item] });
      this.metrics.created++;
      
      console.log(`‚úÖ –¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω: ${item.offer_id}`);
      return result;
    } catch (error: any) {
      this.metrics.failed++;
      this.metrics.errors.push({
        offerId: item.offer_id,
        error: error.message
      });
      
      console.error(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä ${item.offer_id}:`, error);
      throw error;
    }
  }
  
  getMetrics() {
    return { ...this.metrics };
  }
  
  resetMetrics() {
    this.metrics = { created: 0, updated: 0, failed: 0, errors: [] };
  }
}
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ API

- **[Category API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
- **[Finance API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å –ø–æ —Ç–æ–≤–∞—Ä–∞–º  
- **[Analytics API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂
- **[FBO API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ FBO
- **[FBS API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ FBS

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–ù–∞—à–ª–∏ –æ—à–∏–±–∫—É –∏–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–ª—É—á—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é?**
- üêõ [–°–æ–∑–¥–∞—Ç—å Issue](https://github.com/salacoste/ozon-daytona-seller-api/issues/new)
- üîß [Pull Request](https://github.com/salacoste/ozon-daytona-seller-api/compare)
- üí¨ [GitHub Discussions](https://github.com/salacoste/ozon-daytona-seller-api/discussions)

**–ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:**
- üìö [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è OZON](https://docs.ozon.ru/api/seller/)
- ‚≠ê [–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π SDK](https://github.com/salacoste/ozon-daytona-seller-api)
- üì¶ [NPM –ø–∞–∫–µ—Ç](https://www.npmjs.com/package/daytona-ozon-seller-api)

---

üè† [–ì–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../README.md) | üìö [–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏](./README.md)
```