# üí∞ Finance API - –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å

**–ö–ª—é—á–µ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –ø—Ä–æ–¥–∞–≤—Ü–∞** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤, –∞–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –≤–∑–∞–∏–º–æ—Ä–∞—Å—á—ë—Ç—ã —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–º OZON.

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ API

Finance API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è:
- **–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å** ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è—Ö –∏ —Å–ø–∏—Å–∞–Ω–∏—è—Ö
- **–í–∑–∞–∏–º–æ—Ä–∞—Å—á—ë—Ç—ã** ‚Äî –æ—Ç—á—ë—Ç—ã –æ –≤–∑–∞–∏–º–æ—Ä–∞—Å—á—ë—Ç–∞—Ö —Å OZON
- **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è–º–∏ –∏ –¥–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è–º–∏
- **B2B –ø—Ä–æ–¥–∞–∂–∏** ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü
- **–í—ã–∫—É–ø–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã** ‚Äî –æ—Ç—á—ë—Ç—ã –ø–æ —Ç–æ–≤–∞—Ä–∞–º –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –≤ –ï–ê–≠–°

---

## üìã –°–ø–∏—Å–æ–∫ –º–µ—Ç–æ–¥–æ–≤ (10 endpoints)

### üìä –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Ç—á—ë—Ç—ã
| –ú–µ—Ç–æ–¥ | Endpoint | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|---------|------------|
| `getTransactionList` | `/v3/finance/transaction/list` | v3 | –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π |
| `getTransactionTotals` | `/v3/finance/transaction/totals` | v3 | –ò—Ç–æ–≥–æ–≤—ã–µ —Å—É–º–º—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π |
| `getRealizationReport` | `/v2/finance/realization` | v2 | –û—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ |
| `getRealizationReportPosting` | `/v1/finance/realization/posting` | v1 | –ü–æ–∑–∞–∫–∞–∑–Ω—ã–π –æ—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ |

### üè¢ B2B –æ—Ç—á—ë—Ç—ã
| –ú–µ—Ç–æ–¥ | Endpoint | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|---------|------------|
| `getDocumentB2BSalesReport` | `/v1/finance/document-b2b-sales` | v1 | –†–µ–µ—Å—Ç—Ä –ø—Ä–æ–¥–∞–∂ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º |
| `getDocumentB2BSalesJSON` | `/v1/finance/document-b2b-sales/json` | v1 | B2B –æ—Ç—á—ë—Ç –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ |
| `getMutualSettlementReport` | `/v1/finance/mutual-settlement` | v1 | –û—Ç—á—ë—Ç –æ –≤–∑–∞–∏–º–æ—Ä–∞—Å—á—ë—Ç–∞—Ö |

### üîÑ –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã  
| –ú–µ—Ç–æ–¥ | Endpoint | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|---------|------------|
| `getCompensationReport` | `/v1/finance/compensation` | v1 | –û—Ç—á—ë—Ç –æ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è—Ö |
| `getDecompensationReport` | `/v1/finance/decompensation` | v1 | –û—Ç—á—ë—Ç –æ –¥–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è—Ö |
| `getProductsBuyoutReport` | `/v1/finance/products/buyout` | v1 | –û—Ç—á—ë—Ç –æ –≤—ã–∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
```typescript
import { OzonSellerAPI } from 'daytona-ozon-seller-api';

const client = new OzonSellerAPI({
  clientId: 'your-client-id',
  apiKey: 'your-api-key'
});
```

### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```typescript
try {
  const transactions = await client.finance.getTransactionList({
    filter: {
      date: {
        from: '2024-01-01T00:00:00.000Z',
        to: '2024-01-31T23:59:59.999Z'
      },
      operation_type: ['orders'], // –¢–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã
      posting_number: [] // –í—Å–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    },
    page: 1,
    page_size: 1000
  });

  console.log(`üí∞ –ù–∞–π–¥–µ–Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${transactions.result?.operations?.length || 0}`);
  
  // –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  let totalIncome = 0;
  let totalExpenses = 0;
  
  transactions.result?.operations?.forEach(operation => {
    const amount = parseFloat(operation.amount || '0');
    if (amount > 0) {
      totalIncome += amount;
    } else {
      totalExpenses += Math.abs(amount);
    }
    
    console.log(`${operation.operation_date}: ${operation.operation_type} - ${amount}‚ÇΩ`);
  });
  
  console.log(`üìà –î–æ—Ö–æ–¥—ã: ${totalIncome}‚ÇΩ`);
  console.log(`üìâ –†–∞—Å—Ö–æ–¥—ã: ${totalExpenses}‚ÇΩ`);
  console.log(`üí∞ –ü—Ä–∏–±—ã–ª—å: ${totalIncome - totalExpenses}‚ÇΩ`);
  
} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:', error);
}
```

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º
```typescript
try {
  const totals = await client.finance.getTransactionTotals({
    date: {
      from: '2024-01-01T00:00:00.000Z',
      to: '2024-01-31T23:59:59.999Z'
    },
    transaction_type: 'all' // –í—Å–µ —Ç–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π
  });

  const result = totals.result;
  if (result) {
    console.log('üìä –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –∑–∞ –º–µ—Å—è—Ü:');
    console.log(`üí∏ –ê–∫—Ü–∏–∏: ${result.accruals_for_sale || 0}‚ÇΩ`);
    console.log(`üì¶ –¢–æ–≤–∞—Ä—ã: ${result.sale_commission || 0}‚ÇΩ`);
    console.log(`üöö –î–æ—Å—Ç–∞–≤–∫–∞: ${result.postings || 0}‚ÇΩ`);
    console.log(`üîÑ –í–æ–∑–≤—Ä–∞—Ç—ã: ${result.returns || 0}‚ÇΩ`);
    console.log(`üí∞ –ò—Ç–æ–≥–æ –∫ –≤—ã–ø–ª–∞—Ç–µ: ${result.others || 0}‚ÇΩ`);
  }
} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤:', error);
}
```

#### 3. –û—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
```typescript
try {
  // –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á—ë—Ç –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü
  const currentDate = new Date();
  const lastMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1);
  
  const report = await client.finance.getRealizationReport({
    month: lastMonth.getMonth() + 1, // –ú–µ—Å—è—Ü –æ—Ç 1 –¥–æ 12
    year: lastMonth.getFullYear()
  });

  console.log('üìã –û—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤');
  console.log(`üìÑ –ó–∞–≥–æ–ª–æ–≤–æ–∫: ${report.result?.header?.doc_number || 'N/A'}`);
  console.log(`üìÖ –ü–µ—Ä–∏–æ–¥: ${report.result?.header?.doc_date || 'N/A'}`);
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫ –æ—Ç—á—ë—Ç–∞
  const rows = report.result?.rows || [];
  let totalSales = 0;
  
  rows.forEach(row => {
    if (row.row_number && row.row_number > 0) {
      const amount = parseFloat(row.sale_price || '0');
      totalSales += amount;
      
      console.log(`üì¶ ${row.product_name}: ${amount}‚ÇΩ`);
    }
  });
  
  console.log(`üí∞ –û–±—â–∏–µ –ø—Ä–æ–¥–∞–∂–∏: ${totalSales}‚ÇΩ`);
  
} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç–∞ –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
}
```

---

## üéØ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üìä –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞ –ø–µ—Ä–∏–æ–¥

**–ó–∞–¥–∞—á–∞**: –ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –∑–∞ –º–µ—Å—è—Ü —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ —Ç–∏–ø–∞–º –æ–ø–µ—Ä–∞—Ü–∏–π

```typescript
class FinanceAnalyzer {
  async analyzeMonth(year: number, month: number) {
    console.log(`üìä –ê–Ω–∞–ª–∏–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –∑–∞ ${month}/${year}...`);
    
    const startDate = new Date(year, month - 1, 1);
    const endDate = new Date(year, month, 0, 23, 59, 59, 999);
    
    try {
      // 1. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞ –º–µ—Å—è—Ü
      const allTransactions = await this.getAllTransactions(startDate, endDate);
      
      // 2. –ü–æ–ª—É—á–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ —Å—É–º–º—ã
      const totals = await client.finance.getTransactionTotals({
        date: {
          from: startDate.toISOString(),
          to: endDate.toISOString()
        },
        transaction_type: 'all'
      });
      
      // 3. –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
      const realizationReport = await client.finance.getRealizationReport({
        month: month,
        year: year
      });
      
      // 4. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
      const analysis = this.processFinancialData(
        allTransactions,
        totals.result,
        realizationReport.result
      );
      
      // 5. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç
      this.generateReport(analysis);
      
      return analysis;
      
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤:', error);
      throw error;
    }
  }
  
  private async getAllTransactions(startDate: Date, endDate: Date) {
    const allOperations = [];
    let page = 1;
    const pageSize = 1000;
    
    while (true) {
      const batch = await client.finance.getTransactionList({
        filter: {
          date: {
            from: startDate.toISOString(),
            to: endDate.toISOString()
          }
        },
        page: page,
        page_size: pageSize
      });
      
      const operations = batch.result?.operations || [];
      allOperations.push(...operations);
      
      console.log(`üì• –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${allOperations.length}`);
      
      if (operations.length < pageSize) {
        break; // –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
      }
      
      page++;
      
      // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
    
    return allOperations;
  }
  
  private processFinancialData(transactions: any[], totals: any, realization: any) {
    // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ —Ç–∏–ø–∞–º
    const groupedTransactions = this.groupTransactionsByType(transactions);
    
    // –†–∞—Å—á—ë—Ç –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
    const metrics = {
      totalRevenue: 0,
      totalExpenses: 0,
      netProfit: 0,
      orderCount: 0,
      avgOrderValue: 0,
      returnRate: 0,
      // ... –¥—Ä—É–≥–∏–µ –º–µ—Ç—Ä–∏–∫–∏
    };
    
    // –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç–æ–≤–∞—Ä–æ–≤
    const categoryAnalysis = this.analyzeByCatgeories(transactions);
    
    // –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤
    const trends = this.analyzeTrends(transactions);
    
    return {
      metrics,
      groupedTransactions,
      categoryAnalysis,
      trends,
      totals,
      realization
    };
  }
  
  private groupTransactionsByType(transactions: any[]) {
    const groups: { [key: string]: any[] } = {};
    
    transactions.forEach(transaction => {
      const type = transaction.operation_type || 'unknown';
      if (!groups[type]) {
        groups[type] = [];
      }
      groups[type].push(transaction);
    });
    
    return groups;
  }
  
  private generateReport(analysis: any) {
    console.log('\nüìä –§–ò–ù–ê–ù–°–û–í–´–ô –û–¢–ß–Å–¢');
    console.log('===================');
    
    console.log('\nüí∞ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:');
    console.log(`  –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞: ${analysis.metrics.totalRevenue}‚ÇΩ`);
    console.log(`  –û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã: ${analysis.metrics.totalExpenses}‚ÇΩ`);
    console.log(`  –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: ${analysis.metrics.netProfit}‚ÇΩ`);
    console.log(`  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤: ${analysis.metrics.orderCount}`);
    console.log(`  –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ${analysis.metrics.avgOrderValue}‚ÇΩ`);
    
    console.log('\nüì¶ –ü–æ —Ç–∏–ø–∞–º –æ–ø–µ—Ä–∞—Ü–∏–π:');
    Object.entries(analysis.groupedTransactions).forEach(([type, operations]) => {
      const total = operations.reduce((sum: number, op: any) => 
        sum + parseFloat(op.amount || '0'), 0);
      console.log(`  ${type}: ${total}‚ÇΩ (${operations.length} –æ–ø–µ—Ä–∞—Ü–∏–π)`);
    });
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const analyzer = new FinanceAnalyzer();
const analysis = await analyzer.analyzeMonth(2024, 1);
```

### üè¢ –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è B2B –æ—Ç—á—ë—Ç–æ–≤

**–ó–∞–¥–∞—á–∞**: –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤ –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏

```typescript
class B2BReportGenerator {
  async generateMonthlyReports(year: number, month: number) {
    console.log(`üìã –ì–µ–Ω–µ—Ä–∞—Ü–∏—è B2B –æ—Ç—á—ë—Ç–æ–≤ –∑–∞ ${month}/${year}...`);
    
    const dateStr = `${year}-${month.toString().padStart(2, '0')}`;
    
    try {
      // 1. –†–µ–µ—Å—Ç—Ä –ø—Ä–æ–¥–∞–∂ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º (PDF)
      const salesReportPDF = await client.finance.getDocumentB2BSalesReport({
        date: dateStr,
        language: 'RU'
      });
      
      console.log('‚úÖ PDF –æ—Ç—á—ë—Ç –æ –ø—Ä–æ–¥–∞–∂–∞—Ö B2B —Å–æ–∑–¥–∞–Ω');
      
      // 2. –†–µ–µ—Å—Ç—Ä –ø—Ä–æ–¥–∞–∂ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
      const salesReportJSON = await client.finance.getDocumentB2BSalesJSON({
        date: dateStr
      });
      
      console.log('‚úÖ JSON –æ—Ç—á—ë—Ç –æ –ø—Ä–æ–¥–∞–∂–∞—Ö B2B –ø–æ–ª—É—á–µ–Ω');
      
      // 3. –û—Ç—á—ë—Ç –æ –≤–∑–∞–∏–º–æ—Ä–∞—Å—á—ë—Ç–∞—Ö
      const settlementReport = await client.finance.getMutualSettlementReport({
        date: dateStr,
        language: 'RU'
      });
      
      console.log('‚úÖ –û—Ç—á—ë—Ç –æ –≤–∑–∞–∏–º–æ—Ä–∞—Å—á—ë—Ç–∞—Ö —Å–æ–∑–¥–∞–Ω');
      
      // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ JSON –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
      const jsonData = salesReportJSON;
      if (jsonData.invoices) {
        console.log(`üìÑ –ù–∞–π–¥–µ–Ω–æ —Å—á–µ—Ç–æ–≤-—Ñ–∞–∫—Ç—É—Ä: ${jsonData.invoices.length}`);
        
        let totalB2BSales = 0;
        jsonData.invoices.forEach((invoice: any) => {
          const amount = parseFloat(invoice.total_amount || '0');
          totalB2BSales += amount;
          
          console.log(`üè¢ ${invoice.buyer_name}: ${amount}‚ÇΩ`);
        });
        
        console.log(`üí∞ –û–±—â–∏–µ B2B –ø—Ä–æ–¥–∞–∂–∏: ${totalB2BSales}‚ÇΩ`);
      }
      
      // 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á—ë—Ç–æ–≤ –≤ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—é (–ø—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
      await this.sendReportsToAccounting({
        salesReportPDF,
        settlementReport,
        jsonAnalysis: this.analyzeB2BData(salesReportJSON),
        period: `${month}/${year}`
      });
      
      console.log('üìß –û—Ç—á—ë—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—é');
      
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ B2B –æ—Ç—á—ë—Ç–æ–≤:', error);
      throw error;
    }
  }
  
  private analyzeB2BData(jsonData: any) {
    const analysis = {
      totalInvoices: 0,
      totalAmount: 0,
      topClients: [] as Array<{name: string, amount: number}>,
      avgInvoiceAmount: 0
    };
    
    if (jsonData.invoices && Array.isArray(jsonData.invoices)) {
      analysis.totalInvoices = jsonData.invoices.length;
      
      const clientTotals = new Map<string, number>();
      
      jsonData.invoices.forEach((invoice: any) => {
        const amount = parseFloat(invoice.total_amount || '0');
        analysis.totalAmount += amount;
        
        const clientName = invoice.buyer_name || 'Unknown';
        const currentTotal = clientTotals.get(clientName) || 0;
        clientTotals.set(clientName, currentTotal + amount);
      });
      
      analysis.avgInvoiceAmount = analysis.totalAmount / analysis.totalInvoices;
      
      // –¢–æ–ø –∫–ª–∏–µ–Ω—Ç—ã
      analysis.topClients = Array.from(clientTotals.entries())
        .map(([name, amount]) => ({ name, amount }))
        .sort((a, b) => b.amount - a.amount)
        .slice(0, 10);
    }
    
    return analysis;
  }
  
  private async sendReportsToAccounting(reports: any) {
    // –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏
    // –ù–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ API, email –∏–ª–∏ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    console.log('üìä –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—Ç—á—ë—Ç–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏...');
    
    // –ü—Ä–∏–º–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
    const fs = require('fs').promises;
    const reportsDir = `./reports/${reports.period}`;
    
    // await fs.mkdir(reportsDir, { recursive: true });
    // await fs.writeFile(`${reportsDir}/b2b_analysis.json`, JSON.stringify(reports.jsonAnalysis, null, 2));
    
    console.log(`üíæ –û—Ç—á—ë—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ ${reportsDir}`);
  }
}
```

### üí∏ –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π –∏ –¥–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π

**–ó–∞–¥–∞—á–∞**: –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Å–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—É–º–º–∞—Ö

```typescript
class CompensationMonitor {
  private readonly ALERT_THRESHOLD = 10000; // 10,000‚ÇΩ
  
  async monitorCompensations(year: number, month: number) {
    console.log(`üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π –∑–∞ ${month}/${year}...`);
    
    const dateStr = `${year}-${month.toString().padStart(2, '0')}`;
    
    try {
      // 1. –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á—ë—Ç –æ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è—Ö
      const compensationReport = await client.finance.getCompensationReport({
        date: dateStr,
        language: 'RU'
      });
      
      console.log('‚úÖ –û—Ç—á—ë—Ç –æ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è—Ö –ø–æ–ª—É—á–µ–Ω');
      
      // 2. –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á—ë—Ç –æ –¥–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è—Ö  
      const decompensationReport = await client.finance.getDecompensationReport({
        date: dateStr,
        language: 'RU'
      });
      
      console.log('‚úÖ –û—Ç—á—ë—Ç –æ –¥–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è—Ö –ø–æ–ª—É—á–µ–Ω');
      
      // 3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
      const transactions = await this.getCompensationTransactions(dateStr);
      
      const analysis = this.analyzeCompensations(transactions);
      
      // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
      const alerts = this.checkAlerts(analysis);
      
      if (alerts.length > 0) {
        console.log('üö® –û–ë–ù–ê–†–£–ñ–ï–ù–´ –ê–õ–ï–†–¢–´:');
        alerts.forEach(alert => {
          console.log(`  ‚ö†Ô∏è ${alert.type}: ${alert.amount}‚ÇΩ - ${alert.reason}`);
        });
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        await this.sendAlerts(alerts);
      }
      
      // 5. –°–æ–∑–¥–∞—ë–º —Å–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç
      this.generateCompensationSummary(analysis);
      
      return analysis;
      
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π:', error);
      throw error;
    }
  }
  
  private async getCompensationTransactions(dateStr: string) {
    const [year, month] = dateStr.split('-').map(Number);
    const startDate = new Date(year, month - 1, 1);
    const endDate = new Date(year, month, 0, 23, 59, 59, 999);
    
    const transactions = await client.finance.getTransactionList({
      filter: {
        date: {
          from: startDate.toISOString(),
          to: endDate.toISOString()
        },
        operation_type: ['compensation'] // –¢–æ–ª—å–∫–æ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
      },
      page: 1,
      page_size: 1000
    });
    
    return transactions.result?.operations || [];
  }
  
  private analyzeCompensations(transactions: any[]) {
    const analysis = {
      totalCompensation: 0,
      totalDecompensation: 0,
      netCompensation: 0,
      compensationCount: 0,
      decompensationCount: 0,
      largeCompensations: [] as any[],
      byReason: new Map<string, { amount: number, count: number }>()
    };
    
    transactions.forEach(transaction => {
      const amount = parseFloat(transaction.amount || '0');
      const reason = transaction.operation_type_name || 'Unknown';
      
      if (amount > 0) {
        // –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞)
        analysis.totalCompensation += amount;
        analysis.compensationCount++;
        
        if (amount > this.ALERT_THRESHOLD) {
          analysis.largeCompensations.push({
            amount,
            reason,
            date: transaction.operation_date,
            posting: transaction.posting_number
          });
        }
      } else {
        // –î–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞)
        const absAmount = Math.abs(amount);
        analysis.totalDecompensation += absAmount;
        analysis.decompensationCount++;
        
        if (absAmount > this.ALERT_THRESHOLD) {
          analysis.largeCompensations.push({
            amount: absAmount,
            reason: `–î–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è: ${reason}`,
            date: transaction.operation_date,
            posting: transaction.posting_number
          });
        }
      }
      
      // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–∏—á–∏–Ω–∞–º
      const current = analysis.byReason.get(reason) || { amount: 0, count: 0 };
      analysis.byReason.set(reason, {
        amount: current.amount + Math.abs(amount),
        count: current.count + 1
      });
    });
    
    analysis.netCompensation = analysis.totalCompensation - analysis.totalDecompensation;
    
    return analysis;
  }
  
  private checkAlerts(analysis: any) {
    const alerts = [];
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä—É–ø–Ω—ã—Ö –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π
    analysis.largeCompensations.forEach((comp: any) => {
      alerts.push({
        type: '–ö—Ä—É–ø–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è',
        amount: comp.amount,
        reason: comp.reason,
        details: `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: ${comp.posting}, –î–∞—Ç–∞: ${comp.date}`
      });
    });
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—â–µ–π —Å—É–º–º—ã –¥–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π
    if (analysis.totalDecompensation > 50000) {
      alerts.push({
        type: '–í—ã—Å–æ–∫–∞—è —Å—É–º–º–∞ –¥–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π',
        amount: analysis.totalDecompensation,
        reason: '–û–±—â–∞—è —Å—É–º–º–∞ –¥–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π –ø—Ä–µ–≤—ã—à–∞–µ—Ç 50,000‚ÇΩ',
        details: `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π: ${analysis.decompensationCount}`
      });
    }
    
    return alerts;
  }
  
  private async sendAlerts(alerts: any[]) {
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ —á–µ—Ä–µ–∑ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
    console.log('üìß –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤...');
    
    // –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å:
    // - –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç–æ–π
    // - Slack/Telegram
    // - SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
    // - –°–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    
    alerts.forEach(alert => {
      console.log(`üîî –ê–ª–µ—Ä—Ç: ${JSON.stringify(alert, null, 2)}`);
    });
  }
  
  private generateCompensationSummary(analysis: any) {
    console.log('\nüí∏ –û–¢–ß–Å–¢ –ü–û –ö–û–ú–ü–ï–ù–°–ê–¶–ò–Ø–ú');
    console.log('=======================');
    
    console.log(`üí∞ –û–±—â–∏–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏: ${analysis.totalCompensation}‚ÇΩ (${analysis.compensationCount} –æ–ø–µ—Ä–∞—Ü–∏–π)`);
    console.log(`üí∏ –û–±—â–∏–µ –¥–µ–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏: ${analysis.totalDecompensation}‚ÇΩ (${analysis.decompensationCount} –æ–ø–µ—Ä–∞—Ü–∏–π)`);
    console.log(`üè¶ –ß–∏—Å—Ç—ã–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏: ${analysis.netCompensation}‚ÇΩ`);
    
    console.log('\nüìä –ü–æ –ø—Ä–∏—á–∏–Ω–∞–º:');
    Array.from(analysis.byReason.entries())
      .sort(([,a], [,b]) => b.amount - a.amount)
      .slice(0, 10)
      .forEach(([reason, data]) => {
        console.log(`  ${reason}: ${data.amount}‚ÇΩ (${data.count} –æ–ø–µ—Ä–∞—Ü–∏–π)`);
      });
  }
}
```

---

## üìù TypeScript —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ Request –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
// –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
interface FinanceTransactionListV3Request {
  filter?: FinanceTransactionListV3RequestFilter;
  page: number;
  page_size: number;
}

interface FinanceTransactionListV3RequestFilter {
  date?: {
    from: string; // ISO 8601 format
    to: string;   // ISO 8601 format
  };
  operation_type?: ('orders' | 'returns' | 'services' | 'compensation' | 'transferDelivery' | 'other')[];
  posting_number?: string[];
  transaction_type?: 'all' | 'orders' | 'returns' | 'services' | 'compensation' | 'transferDelivery' | 'other';
}

// –ò—Ç–æ–≥–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
interface FinanceTransactionTotalsV3Request {
  date?: {
    from: string; // ISO 8601 format
    to: string;   // ISO 8601 format
  };
  posting_number?: string;
  transaction_type?: 'all' | 'orders' | 'returns' | 'services' | 'compensation' | 'transferDelivery' | 'other';
}

// –û—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
interface GetRealizationReportRequestV2 {
  month: number; // 1-12
  year: number;  // –ù–∞–ø—Ä–∏–º–µ—Ä, 2024
}

interface GetRealizationReportPostingRequest {
  month: number; // 1-12
  year: number;  // –ù–∞–ø—Ä–∏–º–µ—Ä, 2024
}

// B2B –æ—Ç—á—ë—Ç—ã
interface CreateDocumentB2BSalesReportRequest {
  date: string;    // –§–æ—Ä–º–∞—Ç YYYY-MM
  language?: 'RU' | 'EN';
}

interface CreateDocumentB2BSalesJSONReportRequest {
  date: string; // –§–æ—Ä–º–∞—Ç YYYY-MM, –¥–æ—Å—Ç—É–ø–µ–Ω –¥–æ —è–Ω–≤–∞—Ä—è 2019
}

interface CreateMutualSettlementReportRequest {
  date: string;    // –§–æ—Ä–º–∞—Ç YYYY-MM
  language?: 'RU' | 'EN';
}

// –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
interface GetCompensationReportRequest {
  date: string;    // –§–æ—Ä–º–∞—Ç YYYY-MM
  language?: 'RU' | 'EN';
}

interface GetDecompensationReportRequest {
  date: string;    // –§–æ—Ä–º–∞—Ç YYYY-MM
  language?: 'RU' | 'EN';
}

// –í—ã–∫—É–ø–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
interface GetFinanceProductsBuyoutRequest {
  date_from: string; // –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞
  date_to: string;   // –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (–º–∞–∫—Å. 31 –¥–µ–Ω—å)
}
```

### Response –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
// –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
interface FinanceTransactionListV3Response {
  result?: {
    operations?: FinanceOperation[];
    page?: number;
    page_size?: number;
    page_count?: number;
  };
}

interface FinanceOperation {
  operation_id?: string;
  operation_type?: string;
  operation_type_name?: string;
  operation_date?: string;
  operation_date_full?: string;
  description?: string;
  accruals_for_sale?: string;
  sale_commission?: string;
  amount?: string;
  type?: string;
  posting_number?: string;
  posting_number_child?: string;
  cluster_from?: string;
  cluster_to?: string;
  product_id?: number;
  product_name?: string;
  warehouse_id?: number;
  warehouse_name?: string;
  region_from?: string;
  region_to?: string;
  delivery_schema?: string;
  tariff_zone?: string;
  payment_subject?: string;
  delivery_type?: string;
}

// –ò—Ç–æ–≥–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
interface FinanceTransactionTotalsV3Response {
  result?: {
    accruals_for_sale?: string;
    sale_commission?: string;
    postings?: string;
    returns?: string;
    services?: string;
    compensation?: string;
    others?: string;
    acquiring_bank?: string;
    acquiring_percent?: string;
    acquiring_fix?: string;
    claim?: string;
    revenue?: string;
  };
}

// –û—Ç—á—ë—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
interface GetRealizationReportResponseV2 {
  result?: {
    header?: RealizationReportHeader;
    rows?: RealizationReportRow[];
  };
}

interface RealizationReportHeader {
  doc_number?: string;
  doc_date?: string;
  contract_date?: string;
  contract_number?: string;
  currency_code?: string;
  seller_name?: string;
  seller_inn?: string;
  seller_kpp?: string;
  seller_address?: string;
}

interface RealizationReportRow {
  row_number?: number;
  product_id?: number;
  product_name?: string;
  brand_name?: string;
  model?: string;
  posting_number?: string;
  posting_date?: string;
  warehouse_name?: string;
  supplier_name?: string;
  sale_price?: string;
  for_pay?: string;
  partial_num?: number;
}

// B2B JSON –æ—Ç—á—ë—Ç
interface CreateDocumentB2BSalesJSONReportResponse {
  date_from?: string;     // YYYY-MM-DD
  date_to?: string;       // YYYY-MM-DD
  invoices?: B2BInvoice[];
  seller_info?: B2BSellerInfo;
}

interface B2BInvoice {
  invoice_number?: string;
  invoice_date?: string;
  buyer_name?: string;
  buyer_inn?: string;
  buyer_kpp?: string;
  total_amount?: string;
  currency_code?: string;
  items?: B2BInvoiceItem[];
}

interface B2BInvoiceItem {
  product_name?: string;
  quantity?: number;
  unit_price?: string;
  total_price?: string;
  vat_rate?: string;
  vat_amount?: string;
}

interface B2BSellerInfo {
  name?: string;
  inn?: string;
  kpp?: string;
  address?: string;
}

// –í—ã–∫—É–ø–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
interface GetFinanceProductsBuyoutResponse {
  products?: BuyoutProduct[];
}

interface BuyoutProduct {
  product_id?: number;
  offer_id?: string;
  product_name?: string;
  price?: string;
  quantity?: number;
  amount?: string;
  currency_code?: string;
  warehouse_id?: number;
  warehouse_name?: string;
  cluster_from?: string;
  cluster_to?: string;
  region_from?: string;
  region_to?: string;
}

// –ë–∞–∑–æ–≤—ã–µ response —Ç–∏–ø—ã –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤
interface CreateReportResponse {
  result?: string; // –û–±—ã—á–Ω–æ "ok"
}
```

---

## üö® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ API –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ —Å –¥–æ–≥–æ–≤–æ—Ä–æ–º –¢–û–û ¬´–û–ó–û–ù –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω¬ª:
- `getRealizationReport` (v2)  
- `getRealizationReportPosting` (v1)

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ ‚Äî 1 –º–µ—Å—è—Ü
- **–í—ã–∫—É–ø–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ ‚Äî 31 –¥–µ–Ω—å
- **B2B JSON –æ—Ç—á—ë—Ç**: –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–æ —è–Ω–≤–∞—Ä—è 2019 –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
- **–û—Ç—á—ë—Ç—ã –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: –î–æ—Å—Ç—É–ø–Ω—ã —Å –∞–≤–≥—É—Å—Ç–∞ 2023 –≥–æ–¥–∞

### Rate Limiting
```typescript
// ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
async function getTransactionsSequentially() {
  const results = [];
  
  for (const dateRange of dateRanges) {
    const transactions = await client.finance.getTransactionList({
      filter: { date: dateRange },
      page: 1,
      page_size: 1000
    });
    
    results.push(...transactions.result?.operations || []);
    
    // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
    await new Promise(resolve => setTimeout(resolve, 1000));
  }
  
  return results;
}
```

### –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ**: –î–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥–æ–≤ `getTransactionList` –∏ `getTransactionTotals` –º–æ–≥—É—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ. –î–ª—è —Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–±–∏–Ω–µ—Ç–∞.

---

## üí° –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª—å—à–∏–º–∏ –æ–±—ä—ë–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
```typescript
class FinanceDataManager {
  private readonly BATCH_SIZE = 1000;
  private readonly DELAY_BETWEEN_REQUESTS = 1000; // 1 —Å–µ–∫—É–Ω–¥–∞
  
  async getAllTransactions(startDate: Date, endDate: Date) {
    const allOperations = [];
    let page = 1;
    
    // –†–∞–∑–±–∏–≤–∞–µ–º –±–æ–ª—å—à–æ–π –ø–µ—Ä–∏–æ–¥ –Ω–∞ –º–µ—Å—è—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
    const monthlyRanges = this.splitIntoMonths(startDate, endDate);
    
    for (const range of monthlyRanges) {
      console.log(`üì• –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ ${range.from} - ${range.to}`);
      
      let hasMorePages = true;
      page = 1;
      
      while (hasMorePages) {
        const batch = await client.finance.getTransactionList({
          filter: {
            date: {
              from: range.from,
              to: range.to
            }
          },
          page: page,
          page_size: this.BATCH_SIZE
        });
        
        const operations = batch.result?.operations || [];
        allOperations.push(...operations);
        
        hasMorePages = operations.length === this.BATCH_SIZE;
        page++;
        
        // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–∞—É–∑–∞
        await this.delay(this.DELAY_BETWEEN_REQUESTS);
      }
    }
    
    console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${allOperations.length}`);
    return allOperations;
  }
  
  private splitIntoMonths(startDate: Date, endDate: Date) {
    const ranges = [];
    const current = new Date(startDate);
    
    while (current <= endDate) {
      const monthStart = new Date(current.getFullYear(), current.getMonth(), 1);
      const monthEnd = new Date(current.getFullYear(), current.getMonth() + 1, 0, 23, 59, 59, 999);
      
      ranges.push({
        from: monthStart.toISOString(),
        to: Math.min(monthEnd.getTime(), endDate.getTime()) === endDate.getTime() 
          ? endDate.toISOString() 
          : monthEnd.toISOString()
      });
      
      current.setMonth(current.getMonth() + 1);
    }
    
    return ranges;
  }
  
  private delay(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}
```

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```typescript
class FinanceCache {
  private cache = new Map<string, { data: any; timestamp: number; ttl: number }>();
  
  async getTransactionsCached(filter: any, ttl = 5 * 60 * 1000) { // 5 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const cacheKey = this.generateCacheKey(filter);
    const cached = this.cache.get(cacheKey);
    
    if (cached && (Date.now() - cached.timestamp) < cached.ttl) {
      console.log('üìã –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –∫—ç—à–∞');
      return cached.data;
    }
    
    console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API...');
    const data = await client.finance.getTransactionList(filter);
    
    this.cache.set(cacheKey, {
      data,
      timestamp: Date.now(),
      ttl
    });
    
    return data;
  }
  
  private generateCacheKey(filter: any): string {
    return `transactions_${JSON.stringify(filter)}`;
  }
  
  clearCache() {
    this.cache.clear();
    console.log('üóëÔ∏è –ö—ç—à –æ—á–∏—â–µ–Ω');
  }
}
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
```typescript
class FinanceValidator {
  validateDateRange(startDate: Date, endDate: Date) {
    const diffInMs = endDate.getTime() - startDate.getTime();
    const diffInDays = diffInMs / (1000 * 60 * 60 * 24);
    
    if (diffInDays > 31) {
      throw new Error('‚ùå –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ ‚Äî 31 –¥–µ–Ω—å');
    }
    
    if (startDate > endDate) {
      throw new Error('‚ùå –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è');
    }
    
    if (endDate > new Date()) {
      throw new Error('‚ùå –ù–µ–ª—å–∑—è –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –±—É–¥—É—â–µ–≥–æ');
    }
  }
  
  validateTransactionType(type: string) {
    const validTypes = ['all', 'orders', 'returns', 'services', 'compensation', 'transferDelivery', 'other'];
    
    if (!validTypes.includes(type)) {
      throw new Error(`‚ùå –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: ${type}. –†–∞–∑—Ä–µ—à–µ–Ω—ã: ${validTypes.join(', ')}`);
    }
  }
  
  async safeTransactionRequest<T>(
    operation: () => Promise<T>,
    retries = 3
  ): Promise<T> {
    for (let attempt = 1; attempt <= retries; attempt++) {
      try {
        return await operation();
      } catch (error: any) {
        console.error(`‚ùå –ü–æ–ø—ã—Ç–∫–∞ ${attempt} –Ω–µ —É–¥–∞–ª–∞—Å—å:`, error.message);
        
        if (attempt === retries) {
          throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ ${retries} –ø–æ–ø—ã—Ç–æ–∫: ${error.message}`);
        }
        
        // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        const delay = Math.pow(2, attempt) * 1000;
        console.log(`‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ ${delay}–º—Å –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π...`);
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
    
    throw new Error('Unexpected end of retry loop');
  }
}
```

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏
```typescript
class AutomatedReporting {
  private scheduler = new Map<string, NodeJS.Timeout>();
  
  scheduleMonthlyReports() {
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ –∫–∞–∂–¥–æ–µ 5 —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞ –≤ 9:00
    const cronExpression = '0 9 5 * *'; // 5 —á–∏—Å–ª–æ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞ –≤ 9:00
    
    this.scheduler.set('monthly_reports', this.createSchedule(cronExpression, async () => {
      try {
        const lastMonth = this.getPreviousMonth();
        
        console.log(`üìÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ –∑–∞ ${lastMonth.month}/${lastMonth.year}`);
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –æ—Ç—á—ë—Ç–æ–≤
        await Promise.all([
          this.generateTransactionSummary(lastMonth.year, lastMonth.month),
          this.generateB2BReports(lastMonth.year, lastMonth.month),
          this.generateRealizationReport(lastMonth.year, lastMonth.month),
          this.checkCompensations(lastMonth.year, lastMonth.month)
        ]);
        
        console.log('‚úÖ –í—Å–µ –æ—Ç—á—ë—Ç—ã —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ');
        
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–æ–≤:', error);
        await this.sendErrorAlert(error);
      }
    }));
  }
  
  private createSchedule(cronExpression: string, callback: () => Promise<void>) {
    // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è cron scheduler
    // –ù–∞–ø—Ä–∏–º–µ—Ä, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ node-cron
    console.log(`‚è∞ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ωo –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: ${cronExpression}`);
    
    // –ü—Ä–æ—Å—Ç–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
    const now = new Date();
    const nextRun = new Date(now.getFullYear(), now.getMonth(), 5, 9, 0, 0);
    
    if (nextRun < now) {
      nextRun.setMonth(nextRun.getMonth() + 1);
    }
    
    const delay = nextRun.getTime() - now.getTime();
    
    return setTimeout(() => {
      callback();
      this.scheduleMonthlyReports(); // –ü–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
    }, delay);
  }
  
  private getPreviousMonth() {
    const now = new Date();
    const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1);
    
    return {
      year: lastMonth.getFullYear(),
      month: lastMonth.getMonth() + 1
    };
  }
  
  stopAllSchedules() {
    this.scheduler.forEach((timeout, name) => {
      clearTimeout(timeout);
      console.log(`‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ: ${name}`);
    });
    this.scheduler.clear();
  }
}
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ API

- **[Products API](./products.md)** ‚Äî —Ç–æ–≤–∞—Ä—ã –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- **[FBO API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî –∑–∞–∫–∞–∑—ã FBO –¥–ª—è —Å–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  
- **[FBS API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî –∑–∞–∫–∞–∑—ã FBS –¥–ª—è —Å–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **[Analytics API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂
- **[Report API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–ù–∞—à–ª–∏ –æ—à–∏–±–∫—É –∏–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–ª—É—á—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é?**
- üêõ [–°–æ–∑–¥–∞—Ç—å Issue](https://github.com/salacoste/ozon-daytona-seller-api/issues/new)
- üîß [Pull Request](https://github.com/salacoste/ozon-daytona-seller-api/compare)
- üí¨ [GitHub Discussions](https://github.com/salacoste/ozon-daytona-seller-api/discussions)

**–ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:**
- üìö [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è OZON](https://docs.ozon.ru/api/seller/)
- ‚≠ê [–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π SDK](https://github.com/salacoste/ozon-daytona-seller-api)
- üì¶ [NPM –ø–∞–∫–µ—Ç](https://www.npmjs.com/package/daytona-ozon-seller-api)
- üéì [–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π OZON](https://seller-edu.ozon.ru/docs/finances-documents/)

---

üè† [–ì–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../README.md) | üìö [–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏](./README.md)
```