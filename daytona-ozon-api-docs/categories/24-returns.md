# 24. API –í–æ–∑–≤—Ä–∞—Ç—ã

**API –í–æ–∑–≤—Ä–∞—Ç—ã** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —Å—Ö–µ–º–∞–º FBO –∏ FBS –¥–ª—è OZON Seller API.

## –û–±–∑–æ—Ä

API –í–æ–∑–≤—Ä–∞—Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–æ–∑–≤—Ä–∞—Ç–∞—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø–æ–ª–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ —Å—Ö–µ–º—É FBO (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ OZON), —Ç–∞–∫ –∏ FBS (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–æ–º) —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç–∞—Ç—É—Å–∞—Ö, –ø—Ä–∏—á–∏–Ω–∞—Ö –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –∏ —Å—Ä–æ–∫–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ FBO –∏ FBS –≤ –æ–¥–Ω–æ–º API
- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ü–æ –¥–∞—Ç–∞–º, —Å—Ç–∞—Ç—É—Å–∞–º, –ø—Ä–∏—á–∏–Ω–∞–º –≤–æ–∑–≤—Ä–∞—Ç–∞
- **–ü–∞–≥–∏–Ω–∞—Ü–∏—è**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**: –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–∞—Ö, –∫–ª–∏–µ–Ω—Ç–∞—Ö –∏ –ø—Ä–∏—á–∏–Ω–∞—Ö –≤–æ–∑–≤—Ä–∞—Ç–∞

### –¢–∏–ø—ã –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- **FBO –≤–æ–∑–≤—Ä–∞—Ç—ã**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö OZON
- **FBS –≤–æ–∑–≤—Ä–∞—Ç—ã**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–æ–¥–∞–≤—Ü–æ–º
- **–†–∞–∑–ª–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**: –ë—Ä–∞–∫, –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ, –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è

---

## üìä –ú–µ—Ç–æ–¥—ã API

### üìã –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

#### **getList** - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–æ–∑–≤—Ä–∞—Ç–∞—Ö FBO –∏ FBS —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.

```typescript
async getList(
  request: GetReturnsListRequest,
  options?: RequestOptions
): Promise<GetReturnsListResponse>
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
```typescript
interface GetReturnsListRequest {
  filter?: {
    created_at_from?: string;       // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—Ç (ISO 8601)
    created_at_to?: string;         // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–æ (ISO 8601)
    status?: ReturnStatus[];        // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –≤–æ–∑–≤—Ä–∞—Ç–∞
    posting_number?: string;        // –ù–æ–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    return_id?: number;             // ID –≤–æ–∑–≤—Ä–∞—Ç–∞
  };
  limit?: number;                   // –õ–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)
  offset?: number;                  // –°–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
}

type ReturnStatus = 
  | 'NEW'                          // –ù–æ–≤—ã–π –≤–æ–∑–≤—Ä–∞—Ç
  | 'PROCESSING'                   // –í –æ–±—Ä–∞–±–æ—Ç–∫–µ
  | 'COMPLETED'                    // –ó–∞–≤–µ—Ä—à–µ–Ω
  | 'CANCELLED'                    // –û—Ç–º–µ–Ω–µ–Ω
  | 'AWAITING_DELIVERY'            // –û–∂–∏–¥–∞–µ—Ç –¥–æ—Å—Ç–∞–≤–∫–∏
  | 'DELIVERED'                    // –î–æ—Å—Ç–∞–≤–ª–µ–Ω
  | 'AWAITING_RETURN'              // –û–∂–∏–¥–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞
  | 'RETURNED';                    // –í–æ–∑–≤—Ä–∞—â–µ–Ω
```

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ç–≤–µ—Ç–∞:**
```typescript
interface GetReturnsListResponse {
  returns?: Array<{
    return_id: number;             // ID –≤–æ–∑–≤—Ä–∞—Ç–∞
    posting_number: string;        // –ù–æ–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    status: ReturnStatus;          // –°—Ç–∞—Ç—É—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
    created_at: string;            // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ
    products: Array<{
      sku: number;                 // SKU —Ç–æ–≤–∞—Ä–∞
      offer_id: string;            // ID —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞
      name: string;                // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
      price: string;               // –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞
      quantity: number;            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –µ–¥–∏–Ω–∏—Ü
    }>;
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–∑–≤—Ä–∞—Ç–µ
    return_reason?: {
      code: string;                // –ö–æ–¥ –ø—Ä–∏—á–∏–Ω—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
      name: string;                // –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
      description?: string;        // –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
    };
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    customer_info?: {
      customer_id?: string;        // ID –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
      customer_name?: string;      // –ò–º—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
    };
    
    // –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    compensation?: {
      amount: string;              // –°—É–º–º–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
      currency_code: string;       // –í–∞–ª—é—Ç–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
    };
    
    // –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è  
    delivery_info?: {
      tracking_number?: string;    // –¢—Ä–µ–∫-–Ω–æ–º–µ—Ä –≤–æ–∑–≤—Ä–∞—Ç–∞
      expected_delivery?: string;  // –û–∂–∏–¥–∞–µ–º–∞—è –¥–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
      actual_delivery?: string;    // –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
    };
  }>;
  
  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  count?: number;                  // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
  has_next?: boolean;              // –ï—Å—Ç—å –ª–∏ —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
}
```

---

## üöÄ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –≤–æ–∑–≤—Ä–∞—Ç–∞–º–∏

```typescript
import { OzonSellerAPI } from 'daytona-ozon-seller-api';

const api = new OzonSellerAPI({
  clientId: '–≤–∞—à-client-id',
  apiKey: '–≤–∞—à-api-key'
});

// –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
async function completeReturnsAnalysis() {
  const dateFrom = '2024-01-01T00:00:00Z';
  const dateTo = '2024-01-31T23:59:59Z';

  console.log('üìã –ê–Ω–∞–ª–∏–∑ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥...');

  // 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
  const allReturns = await getAllReturnsForPeriod(dateFrom, dateTo);
  console.log(`üìä –í—Å–µ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥: ${allReturns.length}`);

  // 2. –ê–Ω–∞–ª–∏–∑ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
  const statusAnalysis = analyzeReturnsByStatus(allReturns);
  console.log('\nüìà –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º:');
  Object.entries(statusAnalysis).forEach(([status, count]) => {
    console.log(`   ${status}: ${count} –≤–æ–∑–≤—Ä–∞—Ç–æ–≤`);
  });

  // 3. –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
  const reasonAnalysis = analyzeReturnReasons(allReturns);
  console.log('\nüîç –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –≤–æ–∑–≤—Ä–∞—Ç–æ–≤:');
  Object.entries(reasonAnalysis)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 5)
    .forEach(([reason, count]) => {
      console.log(`   ${reason}: ${count} —Å–ª—É—á–∞–µ–≤`);
    });

  // 4. –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
  const financialImpact = calculateFinancialImpact(allReturns);
  console.log('\nüí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –≤–ª–∏—è–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤:');
  console.log(`   –û–±—â–∞—è —Å—É–º–º–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π: ${financialImpact.totalCompensation} RUB`);
  console.log(`   –°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞: ${financialImpact.averageReturn} RUB`);

  // 5. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
  const recommendations = generateRecommendations(allReturns, reasonAnalysis);
  console.log('\nüí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é –≤–æ–∑–≤—Ä–∞—Ç–æ–≤:');
  recommendations.forEach(rec => console.log(`   ‚Ä¢ ${rec}`));

  return {
    totalReturns: allReturns.length,
    statusAnalysis,
    reasonAnalysis,
    financialImpact,
    recommendations
  };
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
async function getAllReturnsForPeriod(dateFrom: string, dateTo: string) {
  const allReturns = [];
  let offset = 0;
  const limit = 100;
  let hasNext = true;

  while (hasNext) {
    console.log(`üì• –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤: offset ${offset}`);
    
    const response = await api.returns.getList({
      filter: {
        created_at_from: dateFrom,
        created_at_to: dateTo
      },
      limit,
      offset
    });

    if (response.returns && response.returns.length > 0) {
      allReturns.push(...response.returns);
      offset += limit;
      hasNext = response.has_next || false;
    } else {
      hasNext = false;
    }

    // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ API
    await new Promise(resolve => setTimeout(resolve, 1000));
  }

  return allReturns;
}

// –ê–Ω–∞–ª–∏–∑ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
function analyzeReturnsByStatus(returns: any[]) {
  return returns.reduce((analysis, returnItem) => {
    const status = returnItem.status || 'UNKNOWN';
    analysis[status] = (analysis[status] || 0) + 1;
    return analysis;
  }, {});
}

// –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
function analyzeReturnReasons(returns: any[]) {
  return returns.reduce((analysis, returnItem) => {
    const reason = returnItem.return_reason?.name || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
    analysis[reason] = (analysis[reason] || 0) + 1;
    return analysis;
  }, {});
}

// –†–∞—Å—á–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –≤–ª–∏—è–Ω–∏—è
function calculateFinancialImpact(returns: any[]) {
  let totalCompensation = 0;
  let returnCount = 0;

  returns.forEach(returnItem => {
    if (returnItem.compensation?.amount) {
      totalCompensation += parseFloat(returnItem.compensation.amount);
      returnCount++;
    }
  });

  return {
    totalCompensation: totalCompensation.toFixed(2),
    averageReturn: returnCount > 0 ? (totalCompensation / returnCount).toFixed(2) : '0',
    affectedReturns: returnCount
  };
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
function generateRecommendations(returns: any[], reasonAnalysis: any) {
  const recommendations = [];
  const totalReturns = returns.length;

  // –ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
  const topReasons = Object.entries(reasonAnalysis)
    .sort(([,a], [,b]) => (b as number) - (a as number))
    .slice(0, 3);

  topReasons.forEach(([reason, count]) => {
    const percentage = ((count as number) / totalReturns * 100).toFixed(1);
    
    if (reason.includes('–±—Ä–∞–∫') || reason.includes('–¥–µ—Ñ–µ–∫—Ç')) {
      recommendations.push(`–£–ª—É—á—à–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ - ${percentage}% –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –ø–æ –ø—Ä–∏—á–∏–Ω–µ "${reason}"`);
    } else if (reason.includes('–Ω–µ –ø–æ–¥–æ—à–µ–ª') || reason.includes('—Ä–∞–∑–º–µ—Ä')) {
      recommendations.push(`–£–ª—É—á—à–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏ —Ç–∞–±–ª–∏—Ü—É —Ä–∞–∑–º–µ—Ä–æ–≤ - ${percentage}% –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ "${reason}"`);
    } else if (reason.includes('–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç')) {
      recommendations.push(`–û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ - ${percentage}% –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ "${reason}"`);
    }
  });

  // –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
  if (totalReturns > 100) {
    recommendations.push('–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö —Ç–æ–≤–∞—Ä–∞');
  }

  return recommendations;
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–æ–∑–≤—Ä–∞—Ç–æ–≤

```typescript
// –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
class ReturnsMonitoring {
  constructor(private api: OzonSellerAPI) {}

  async monitorCriticalReturns(): Promise<ReturnAlert[]> {
    const alerts: ReturnAlert[] = [];
    
    // –ü–æ–ª—É—á–∞–µ–º –≤–æ–∑–≤—Ä–∞—Ç—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    
    const recentReturns = await this.api.returns.getList({
      filter: {
        created_at_from: yesterday.toISOString(),
        created_at_to: new Date().toISOString(),
        status: ['NEW', 'PROCESSING']
      },
      limit: 1000
    });

    if (!recentReturns.returns) return alerts;

    // –ê–Ω–∞–ª–∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π
    const criticality = this.analyzeCriticality(recentReturns.returns);
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤
    if (criticality.highValueReturns > 5) {
      alerts.push({
        type: 'HIGH_VALUE_RETURNS',
        severity: 'HIGH',
        message: `–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${criticality.highValueReturns} –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –¥–æ—Ä–æ–≥–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ 24 —á–∞—Å–∞`,
        action: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–∫–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏'
      });
    }

    if (criticality.frequentCustomerReturns > 3) {
      alerts.push({
        type: 'FREQUENT_CUSTOMER_RETURNS', 
        severity: 'MEDIUM',
        message: `${criticality.frequentCustomerReturns} –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞–º–∏`,
        action: '–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–∏—á–∏–Ω—ã –≤–æ–∑–≤—Ä–∞—Ç–æ–≤'
      });
    }

    if (criticality.defectReturns / recentReturns.returns.length > 0.15) {
      alerts.push({
        type: 'HIGH_DEFECT_RATE',
        severity: 'CRITICAL',
        message: `–í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –ø–æ –±—Ä–∞–∫—É: ${(criticality.defectReturns / recentReturns.returns.length * 100).toFixed(1)}%`,
        action: '–°—Ä–æ—á–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∏ –ø—Ä–æ—Ü–µ—Å—Å –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞'
      });
    }

    return alerts;
  }

  private analyzeCriticality(returns: any[]) {
    return {
      highValueReturns: returns.filter(r => 
        r.products.some(p => parseFloat(p.price) > 5000)
      ).length,
      frequentCustomerReturns: this.countFrequentCustomers(returns),
      defectReturns: returns.filter(r => 
        r.return_reason?.name?.includes('–±—Ä–∞–∫') || 
        r.return_reason?.name?.includes('–¥–µ—Ñ–µ–∫—Ç')
      ).length
    };
  }

  private countFrequentCustomers(returns: any[]): number {
    const customerCounts = returns.reduce((acc, returnItem) => {
      const customerId = returnItem.customer_info?.customer_id;
      if (customerId) {
        acc[customerId] = (acc[customerId] || 0) + 1;
      }
      return acc;
    }, {});

    return Object.values(customerCounts).filter(count => count > 1).length;
  }
}

interface ReturnAlert {
  type: string;
  severity: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';
  message: string;
  action: string;
}
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤

```typescript
// –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
async function advancedReturnsFiltering() {
  console.log('üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤...');

  // 1. –í–æ–∑–≤—Ä–∞—Ç—ã –ø–æ –±—Ä–∞–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é
  const defectReturns = await api.returns.getList({
    filter: {
      created_at_from: getDateDaysAgo(7),
      created_at_to: new Date().toISOString(),
      status: ['NEW', 'PROCESSING', 'COMPLETED']
    },
    limit: 1000
  });

  // –§–∏–ª—å—Ç—Ä—É–µ–º –≤–æ–∑–≤—Ä–∞—Ç—ã —Å –±—Ä–∞–∫–æ–º –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
  const defectiveProducts = defectReturns.returns?.filter(returnItem =>
    returnItem.return_reason?.name?.toLowerCase().includes('–±—Ä–∞–∫') ||
    returnItem.return_reason?.name?.toLowerCase().includes('–¥–µ—Ñ–µ–∫—Ç')
  ) || [];

  console.log(`‚ö†Ô∏è –í–æ–∑–≤—Ä–∞—Ç–æ–≤ –ø–æ –±—Ä–∞–∫—É: ${defectiveProducts.length}`);

  // 2. –ê–Ω–∞–ª–∏–∑ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É
  const productReturnsAnalysis = await analyzeProductReturns('–¢–û–í–ê–†001');
  console.log(`üìä –ê–Ω–∞–ª–∏–∑ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ —Ç–æ–≤–∞—Ä–∞ –¢–û–í–ê–†001:`, productReturnsAnalysis);

  // 3. –í–æ–∑–≤—Ä–∞—Ç—ã —Å –≤—ã—Å–æ–∫–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é
  const highValueReturns = defectReturns.returns?.filter(returnItem =>
    returnItem.products.some(product => parseFloat(product.price) > 10000)
  ) || [];

  console.log(`üí∏ –î–æ—Ä–æ–≥–∏–µ –≤–æ–∑–≤—Ä–∞—Ç—ã (>10,000 —Ä—É–±): ${highValueReturns.length}`);

  // 4. –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
  const processingTimeAnalysis = analyzeProcessingTimes(defectReturns.returns || []);
  console.log('‚è±Ô∏è –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:', processingTimeAnalysis);

  return {
    defectiveCount: defectiveProducts.length,
    highValueCount: highValueReturns.length,
    processingStats: processingTimeAnalysis
  };
}

async function analyzeProductReturns(offerId: string) {
  const productReturns = await api.returns.getList({
    filter: {
      created_at_from: getDateDaysAgo(30) // –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
    },
    limit: 1000
  });

  const filteredReturns = productReturns.returns?.filter(returnItem =>
    returnItem.products.some(product => product.offer_id === offerId)
  ) || [];

  const reasons = filteredReturns.reduce((acc, returnItem) => {
    const reason = returnItem.return_reason?.name || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
    acc[reason] = (acc[reason] || 0) + 1;
    return acc;
  }, {});

  return {
    totalReturns: filteredReturns.length,
    mainReasons: reasons,
    returnRate: `${((filteredReturns.length / 1000) * 100).toFixed(2)}%` // –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç
  };
}

function analyzeProcessingTimes(returns: any[]) {
  const processingTimes = returns
    .filter(r => r.status === 'COMPLETED' && r.created_at)
    .map(r => {
      const created = new Date(r.created_at);
      const completed = new Date(); // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
      return Math.floor((completed.getTime() - created.getTime()) / (1000 * 60 * 60 * 24));
    });

  if (processingTimes.length === 0) {
    return { average: 0, min: 0, max: 0, count: 0 };
  }

  return {
    average: processingTimes.reduce((a, b) => a + b, 0) / processingTimes.length,
    min: Math.min(...processingTimes),
    max: Math.max(...processingTimes),
    count: processingTimes.length
  };
}

function getDateDaysAgo(days: number): string {
  const date = new Date();
  date.setDate(date.getDate() - days);
  return date.toISOString();
}
```

---

## üîÑ –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
```mermaid
graph TD
    A[–ö–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç] --> B[–°–æ–∑–¥–∞–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç –≤ —Å—Ç–∞—Ç—É—Å–µ NEW]
    B --> C[–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–∞–≤—Ü–æ–º]
    C --> D{–¢–∏–ø –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è}
    D -->|FBO| E[–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ OZON]
    D -->|FBS| F[–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–∞–≤—Ü–æ–º]
    E --> G[–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≤–∞—Ä–∞]
    F --> G
    G --> H{–¢–æ–≤–∞—Ä –≤ –ø–æ—Ä—è–¥–∫–µ?}
    H -->|–î–∞| I[–í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤]
    H -->|–ù–µ—Ç| J[–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è/–ó–∞–º–µ–Ω–∞]
    I --> K[–°—Ç–∞—Ç—É—Å COMPLETED]
    J --> K
```

### –¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
1. **CRM —Å–∏—Å—Ç–µ–º–∞** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤—ã—Ö –≤–æ–∑–≤—Ä–∞—Ç–∞—Ö
2. **–°–∫–ª–∞–¥—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞** ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ —Ç–æ–≤–∞—Ä–∞
3. **–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π –∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ —Å—Ä–µ–¥—Å—Ç–≤
4. **–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏** ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—Ç–∞—Ö
5. **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã** ‚Üí –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –°—Ç–∞—Ç—É—Å—ã –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
```typescript
type ReturnStatus = 
  | 'NEW'                     // –ù–æ–≤—ã–π –≤–æ–∑–≤—Ä–∞—Ç, —Ç—Ä–µ–±—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
  | 'PROCESSING'              // –í –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  | 'COMPLETED'               // –í–æ–∑–≤—Ä–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ
  | 'CANCELLED'               // –í–æ–∑–≤—Ä–∞—Ç –æ—Ç–º–µ–Ω–µ–Ω
  | 'AWAITING_DELIVERY'       // –û–∂–∏–¥–∞–µ—Ç –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥
  | 'DELIVERED'               // –î–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ —Å–∫–ª–∞–¥
  | 'AWAITING_RETURN'         // –û–∂–∏–¥–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É
  | 'RETURNED';               // –í–æ–∑–≤—Ä–∞—â–µ–Ω –∫–ª–∏–µ–Ω—Ç—É
```

### –ü—Ä–∏—á–∏–Ω—ã –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
```typescript
interface ReturnReason {
  code: string;               // –°–∏—Å—Ç–µ–º–Ω—ã–π –∫–æ–¥ –ø—Ä–∏—á–∏–Ω—ã
  name: string;               // –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
  description?: string;       // –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
  category: 'defect' | 'customer_choice' | 'delivery_issue' | 'other';
}
```

### –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
```typescript
interface ReturnItem {
  return_id: number;
  posting_number: string;
  status: ReturnStatus;
  created_at: string;
  updated_at?: string;
  
  products: Array<{
    sku: number;
    offer_id: string;
    name: string;
    price: string;
    quantity: number;
    image_url?: string;
  }>;
  
  return_reason?: ReturnReason;
  
  customer_info?: {
    customer_id?: string;
    customer_name?: string;
    contact_phone?: string;
  };
  
  compensation?: {
    amount: string;
    currency_code: 'RUB';
    compensation_type: 'refund' | 'replacement' | 'store_credit';
  };
  
  delivery_info?: {
    tracking_number?: string;
    carrier?: string;
    expected_delivery?: string;
    actual_delivery?: string;
  };
  
  notes?: string;             // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏
}
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
- **–°—Ä–æ–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏**: FBO –≤–æ–∑–≤—Ä–∞—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö OZON
- **FBS –≤–æ–∑–≤—Ä–∞—Ç—ã**: –¢—Ä–µ–±—É—é—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–¥–∞–≤—Ü–æ–º
- **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞
- **–õ–∏–º–∏—Ç—ã API**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **–ü–∞–≥–∏–Ω–∞—Ü–∏—è**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ - 31 –¥–µ–Ω—å
- **–°—Ç–∞—Ç—É—Å—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**: –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- **–†–µ–≥—É–ª—è—Ä–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–æ–∑–≤—Ä–∞—Ç–∞—Ö
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**: –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ CRM –∏ —Å–∫–ª–∞–¥—Å–∫–∏–º —Å–∏—Å—Ç–µ–º–∞–º

---

**–°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2024  
**–í–µ—Ä—Å–∏—è API**: v1  
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–æ–¥–æ–≤**: 1 –º–µ—Ç–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞–º–∏