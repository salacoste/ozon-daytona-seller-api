# üìä Analytics API - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏

**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –æ—Å—Ç–∞—Ç–∫–∞—Ö –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö OZON.

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ API

Analytics API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è:
- **–ê–Ω–∞–ª–∏–∑ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏** ‚Äî —Ä–∞—Å—á—ë—Ç –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –¥–Ω–µ–π –¥–æ –∫–æ–Ω—Ü–∞ –æ—Å—Ç–∞—Ç–∫–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞—Ç–∫–æ–≤** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ —Ç–∏–ø–∞–º
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫—É–ø–æ–∫** ‚Äî –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –æ –ø–æ—Å—Ç–∞–≤–∫–∞—Ö
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–ª–∞–¥–∞** ‚Äî –∞–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–∞–º–∏

---

## üìã –°–ø–∏—Å–æ–∫ –º–µ—Ç–æ–¥–æ–≤ (2 endpoints)

### üìà –ê–Ω–∞–ª–∏–∑ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏
| –ú–µ—Ç–æ–¥ | Endpoint | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|---------|------------|
| `getStocksTurnover` | `/v1/analytics/turnover/stocks` | v1 | –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø—Ä–æ–≥–Ω–æ–∑–æ–º |

### üì¶ –ê–Ω–∞–ª–∏–∑ –æ—Å—Ç–∞—Ç–∫–æ–≤  
| –ú–µ—Ç–æ–¥ | Endpoint | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|---------|------------|
| `getStockOnWarehouses` | `/v2/analytics/stock_on_warehouses` | v2 | –û—Ç—á—ë—Ç –ø–æ –æ—Å—Ç–∞—Ç–∫–∞–º –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö ‚ö†Ô∏è Deprecated |

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –ú–µ—Ç–æ–¥ `getStockOnWarehouses` –±—É–¥–µ—Ç –æ—Ç–∫–ª—é—á—ë–Ω –≤ –±—É–¥—É—â–µ–º. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/v1/analytics/stocks`.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
```typescript
import { OzonSellerAPI } from 'daytona-ozon-seller-api';

const client = new OzonSellerAPI({
  clientId: 'your-client-id',
  apiKey: 'your-api-key'
});
```

### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### 1. –ê–Ω–∞–ª–∏–∑ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤
```typescript
try {
  // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)
  const turnoverReport = await client.analytics.getStocksTurnover({
    limit: 100,
    offset: 0
    // sku: [] - –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
  });

  console.log(`üìä –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ${turnoverReport.items?.length || 0}`);
  
  // –ê–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º –æ—Å—Ç–∞—Ç–∫–∞
  const analysis = {
    critical: 0,
    red: 0,
    yellow: 0,
    green: 0,
    noSales: 0
  };
  
  turnoverReport.items?.forEach(item => {
    console.log(`üì¶ ${item.name} (${item.offer_id}):`);
    console.log(`  ‚Ä¢ –û—Å—Ç–∞—Ç–æ–∫: ${item.current_stock} —à—Ç.`);
    console.log(`  ‚Ä¢ –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏: ${item.ads?.toFixed(1)} —à—Ç/–¥–µ–Ω—å`);
    console.log(`  ‚Ä¢ –•–≤–∞—Ç–∏—Ç –Ω–∞: ${item.idc?.toFixed(0)} –¥–Ω–µ–π`);
    console.log(`  ‚Ä¢ –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å: ${item.turnover?.toFixed(1)} –¥–Ω–µ–π`);
    console.log(`  ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å: ${getGradeEmoji(item.idc_grade)} ${item.idc_grade}`);
    
    // –ü–æ–¥—Å—á—ë—Ç –ø–æ —É—Ä–æ–≤–Ω—è–º
    switch (item.idc_grade) {
      case 'GRADES_CRITICAL': analysis.critical++; break;
      case 'GRADES_RED': analysis.red++; break;
      case 'GRADES_YELLOW': analysis.yellow++; break;
      case 'GRADES_GREEN': analysis.green++; break;
      case 'GRADES_NOSALES': analysis.noSales++; break;
    }
  });
  
  console.log('\nüìà –°–≤–æ–¥–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º –æ—Å—Ç–∞—Ç–∫–∞:');
  console.log(`üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π: ${analysis.critical} —Ç–æ–≤–∞—Ä–æ–≤`);
  console.log(`üî¥ –ö—Ä–∞—Å–Ω—ã–π: ${analysis.red} —Ç–æ–≤–∞—Ä–æ–≤`);
  console.log(`üü° –ñ—ë–ª—Ç—ã–π: ${analysis.yellow} —Ç–æ–≤–∞—Ä–æ–≤`);
  console.log(`üü¢ –ó–µ–ª—ë–Ω—ã–π: ${analysis.green} —Ç–æ–≤–∞—Ä–æ–≤`);
  console.log(`‚ö™ –ë–µ–∑ –ø—Ä–æ–¥–∞–∂: ${analysis.noSales} —Ç–æ–≤–∞—Ä–æ–≤`);
  
} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏:', error);
}

function getGradeEmoji(grade: string): string {
  const gradeEmojis: { [key: string]: string } = {
    'GRADES_CRITICAL': 'üÜò',
    'GRADES_RED': 'üî¥',
    'GRADES_YELLOW': 'üü°',
    'GRADES_GREEN': 'üü¢',
    'GRADES_NOSALES': '‚ö™',
    'GRADES_NONE': '‚è≥'
  };
  return gradeEmojis[grade] || '‚ùì';
}
```

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–æ —Å–∫–ª–∞–¥–∞–º
```typescript
try {
  const stocksReport = await client.analytics.getStockOnWarehouses({
    limit: 100,
    offset: 0,
    warehouse_type: 'ALL' // ALL, FBO, FBS, CROSSDOCK
  });

  console.log('üè™ –û—Ç—á—ë—Ç –ø–æ –æ—Å—Ç–∞—Ç–∫–∞–º –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö:');
  
  const warehouseGroups = new Map<string, any[]>();
  
  stocksReport.result?.rows?.forEach(row => {
    const warehouse = row.warehouse_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–∫–ª–∞–¥';
    
    if (!warehouseGroups.has(warehouse)) {
      warehouseGroups.set(warehouse, []);
    }
    warehouseGroups.get(warehouse)!.push(row);
    
    console.log(`üì¶ ${row.item_name} (${row.item_code}):`);
    console.log(`  ‚Ä¢ –°–∫–ª–∞–¥: ${warehouse}`);
    console.log(`  ‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–æ –∫ –ø—Ä–æ–¥–∞–∂–µ: ${row.free_to_sell_amount} —à—Ç.`);
    console.log(`  ‚Ä¢ –í —Ä–µ–∑–µ—Ä–≤–µ: ${row.reserved_amount} —à—Ç.`);
    console.log(`  ‚Ä¢ –û–∂–∏–¥–∞–µ—Ç—Å—è: ${row.promised_amount} —à—Ç.`);
  });
  
  // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–∫–ª–∞–¥–∞–º
  console.log('\nüè≠ –°–≤–æ–¥–∫–∞ –ø–æ —Å–∫–ª–∞–¥–∞–º:');
  warehouseGroups.forEach((items, warehouse) => {
    const totalAvailable = items.reduce((sum, item) => sum + (item.free_to_sell_amount || 0), 0);
    const totalReserved = items.reduce((sum, item) => sum + (item.reserved_amount || 0), 0);
    const totalPromised = items.reduce((sum, item) => sum + (item.promised_amount || 0), 0);
    
    console.log(`üè™ ${warehouse}:`);
    console.log(`  ‚Ä¢ –¢–æ–≤–∞—Ä–æ–≤: ${items.length}`);
    console.log(`  ‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–æ: ${totalAvailable} —à—Ç.`);
    console.log(`  ‚Ä¢ –í —Ä–µ–∑–µ—Ä–≤–µ: ${totalReserved} —à—Ç.`);
    console.log(`  ‚Ä¢ –û–∂–∏–¥–∞–µ—Ç—Å—è: ${totalPromised} —à—Ç.`);
  });
  
} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤:', error);
}
```

---

## üéØ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üìä –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤

**–ó–∞–¥–∞—á–∞**: –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è

```typescript
class StockReplenishmentSystem {
  private readonly CRITICAL_DAYS_THRESHOLD = 7; // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø–æ—Ä–æ–≥ –≤ –¥–Ω—è—Ö
  private readonly WARNING_DAYS_THRESHOLD = 14; // –ü–æ—Ä–æ–≥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
  private readonly RATE_LIMIT_DELAY = 60000; // 1 –º–∏–Ω—É—Ç–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
  
  async monitorAndAlert() {
    console.log('üîç –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤...');
    
    try {
      // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å—é
      const allItems = await this.getAllTurnoverData();
      
      // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã
      const analysis = this.analyzeStockLevels(allItems);
      
      // –°–æ–∑–¥–∞—ë–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é
      const recommendations = this.generateReplenishmentRecommendations(analysis);
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      if (recommendations.alerts.length > 0) {
        await this.sendAlerts(recommendations);
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á—ë—Ç
      await this.saveAnalysisReport(recommendations);
      
      console.log(`‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à—ë–Ω. –ù–∞–π–¥–µ–Ω–æ ${recommendations.alerts.length} –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤`);
      
      return recommendations;
      
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤:', error);
      throw error;
    }
  }
  
  private async getAllTurnoverData() {
    const allItems = [];
    let offset = 0;
    const limit = 1000;
    
    while (true) {
      console.log(`üì• –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤: offset ${offset}`);
      
      const batch = await client.analytics.getStocksTurnover({
        limit: limit,
        offset: offset
      });
      
      const items = batch.items || [];
      allItems.push(...items);
      
      if (items.length < limit) {
        break; // –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
      }
      
      offset += limit;
      
      // –°–æ–±–ª—é–¥–∞–µ–º –ª–∏–º–∏—Ç 1 –∑–∞–ø—Ä–æ—Å –≤ –º–∏–Ω—É—Ç—É
      await this.delay(this.RATE_LIMIT_DELAY);
    }
    
    console.log(`üìä –ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: ${allItems.length}`);
    return allItems;
  }
  
  private analyzeStockLevels(items: any[]) {
    const analysis = {
      total: items.length,
      critical: [] as any[],
      warning: [] as any[],
      healthy: [] as any[],
      noSales: [] as any[],
      summary: {
        criticalCount: 0,
        warningCount: 0,
        healthyCount: 0,
        noSalesCount: 0,
        averageDaysLeft: 0,
        averageTurnover: 0
      }
    };
    
    let totalDaysLeft = 0;
    let totalTurnover = 0;
    let itemsWithData = 0;
    
    items.forEach(item => {
      const daysLeft = item.idc || 0;
      const hasData = item.ads && item.ads > 0;
      
      if (hasData) {
        totalDaysLeft += daysLeft;
        totalTurnover += item.turnover || 0;
        itemsWithData++;
      }
      
      // –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
      if (item.idc_grade === 'GRADES_NOSALES') {
        analysis.noSales.push(item);
        analysis.summary.noSalesCount++;
      } else if (daysLeft <= this.CRITICAL_DAYS_THRESHOLD || item.idc_grade === 'GRADES_CRITICAL') {
        analysis.critical.push(item);
        analysis.summary.criticalCount++;
      } else if (daysLeft <= this.WARNING_DAYS_THRESHOLD || item.idc_grade === 'GRADES_RED') {
        analysis.warning.push(item);
        analysis.summary.warningCount++;
      } else {
        analysis.healthy.push(item);
        analysis.summary.healthyCount++;
      }
    });
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
    if (itemsWithData > 0) {
      analysis.summary.averageDaysLeft = totalDaysLeft / itemsWithData;
      analysis.summary.averageTurnover = totalTurnover / itemsWithData;
    }
    
    return analysis;
  }
  
  private generateReplenishmentRecommendations(analysis: any) {
    const recommendations = {
      timestamp: new Date().toISOString(),
      summary: analysis.summary,
      alerts: [] as any[],
      actions: [] as any[]
    };
    
    // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã - —Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è
    analysis.critical.forEach((item: any) => {
      const daysLeft = Math.max(0, item.idc || 0);
      const dailySales = item.ads || 0;
      
      // –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –∑–∞–∫–∞–∑–∞ (–Ω–∞ 30 –¥–Ω–µ–π + –∑–∞–ø–∞—Å 20%)
      const recommendedOrder = Math.ceil(dailySales * 30 * 1.2);
      
      recommendations.alerts.push({
        severity: 'CRITICAL',
        offerId: item.offer_id,
        name: item.name,
        currentStock: item.current_stock,
        daysLeft: daysLeft,
        dailySales: dailySales,
        recommendedOrder: recommendedOrder,
        message: `üÜò –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –û–°–¢–ê–¢–û–ö: ${item.name} –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è —á–µ—Ä–µ–∑ ${daysLeft.toFixed(0)} –¥–Ω–µ–π`
      });
      
      recommendations.actions.push({
        type: 'URGENT_REPLENISHMENT',
        offerId: item.offer_id,
        quantity: recommendedOrder,
        priority: 1,
        reason: `–û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ ${daysLeft.toFixed(0)} –¥–Ω–µ–π –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–∞—Ö ${dailySales.toFixed(1)} —à—Ç/–¥–µ–Ω—å`
      });
    });
    
    // –¢–æ–≤–∞—Ä—ã –Ω–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–∏
    analysis.warning.forEach((item: any) => {
      const daysLeft = item.idc || 0;
      const dailySales = item.ads || 0;
      const recommendedOrder = Math.ceil(dailySales * 45 * 1.1); // –ù–∞ 45 –¥–Ω–µ–π + 10%
      
      recommendations.alerts.push({
        severity: 'WARNING',
        offerId: item.offer_id,
        name: item.name,
        currentStock: item.current_stock,
        daysLeft: daysLeft,
        dailySales: dailySales,
        recommendedOrder: recommendedOrder,
        message: `‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è: ${item.name} –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è —á–µ—Ä–µ–∑ ${daysLeft.toFixed(0)} –¥–Ω–µ–π`
      });
      
      recommendations.actions.push({
        type: 'PLANNED_REPLENISHMENT',
        offerId: item.offer_id,
        quantity: recommendedOrder,
        priority: 2,
        reason: `–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–ø–æ–ª–Ω–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–∏–µ –¥–Ω–∏`
      });
    });
    
    return recommendations;
  }
  
  private async sendAlerts(recommendations: any) {
    const criticalCount = recommendations.alerts.filter((a: any) => a.severity === 'CRITICAL').length;
    const warningCount = recommendations.alerts.filter((a: any) => a.severity === 'WARNING').length;
    
    console.log('üìß –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...');
    console.log(`üÜò –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤: ${criticalCount}`);
    console.log(`‚ö†Ô∏è –¢–æ–≤–∞—Ä–æ–≤ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ: ${warningCount}`);
    
    // –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
    // - Email
    // - Slack/Teams
    // - Telegram –±–æ—Ç
    // - SMS
    
    // –ü—Ä–∏–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å
    if (criticalCount > 0) {
      console.log('\nüÜò –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –¢–û–í–ê–†–´:');
      recommendations.alerts
        .filter((a: any) => a.severity === 'CRITICAL')
        .forEach((alert: any) => {
          console.log(`  ‚Ä¢ ${alert.name}: ${alert.daysLeft.toFixed(0)} –¥–Ω–µ–π (–∑–∞–∫–∞–∑–∞—Ç—å ${alert.recommendedOrder} —à—Ç.)`);
        });
    }
  }
  
  private async saveAnalysisReport(recommendations: any) {
    // –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Ñ–∞–π–ª
    console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞...');
    
    const reportSummary = {
      timestamp: recommendations.timestamp,
      totalItems: recommendations.summary.criticalCount + 
                  recommendations.summary.warningCount + 
                  recommendations.summary.healthyCount + 
                  recommendations.summary.noSalesCount,
      critical: recommendations.summary.criticalCount,
      warning: recommendations.summary.warningCount,
      healthy: recommendations.summary.healthyCount,
      noSales: recommendations.summary.noSalesCount,
      averageDaysLeft: recommendations.summary.averageDaysLeft.toFixed(1),
      averageTurnover: recommendations.summary.averageTurnover.toFixed(1)
    };
    
    console.log('üìä –°–≤–æ–¥–∫–∞ –æ—Ç—á—ë—Ç–∞:', reportSummary);
  }
  
  private delay(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
const replenishmentSystem = new StockReplenishmentSystem();
const analysis = await replenishmentSystem.monitorAndAlert();
```

### üè≠ –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ó–∞–¥–∞—á–∞**: –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —Å–∫–ª–∞–¥–∞–º –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏—Å—Ç–∏–∫–∏

```typescript
class WarehouseOptimizer {
  async analyzeWarehouseEfficiency() {
    console.log('üè≠ –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–∫–ª–∞–¥–æ–≤...');
    
    try {
      // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –æ—Å—Ç–∞—Ç–∫–∞–º –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö
      const stockData = await this.getAllWarehouseStocks();
      
      // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏
      const turnoverData = await this.getTurnoverData();
      
      // –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
      const combinedAnalysis = this.combineData(stockData, turnoverData);
      
      // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
      const efficiency = this.analyzeEfficiency(combinedAnalysis);
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
      const recommendations = this.generateOptimizationRecommendations(efficiency);
      
      console.log('üìä –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω');
      return recommendations;
      
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Å–∫–ª–∞–¥–æ–≤:', error);
      throw error;
    }
  }
  
  private async getAllWarehouseStocks() {
    const allStocks = [];
    let offset = 0;
    const limit = 100;
    
    while (true) {
      const batch = await client.analytics.getStockOnWarehouses({
        limit: limit,
        offset: offset,
        warehouse_type: 'ALL'
      });
      
      const stocks = batch.result?.rows || [];
      allStocks.push(...stocks);
      
      if (stocks.length < limit) break;
      offset += limit;
      
      await this.delay(1000);
    }
    
    return allStocks;
  }
  
  private async getTurnoverData() {
    const allTurnover = [];
    let offset = 0;
    const limit = 1000;
    
    while (true) {
      const batch = await client.analytics.getStocksTurnover({
        limit: limit,
        offset: offset
      });
      
      const items = batch.items || [];
      allTurnover.push(...items);
      
      if (items.length < limit) break;
      offset += limit;
      
      await this.delay(60000); // 1 –º–∏–Ω—É—Ç–∞ –¥–ª—è turnover API
    }
    
    return allTurnover;
  }
  
  private combineData(stockData: any[], turnoverData: any[]) {
    const turnoverMap = new Map(
      turnoverData.map(item => [item.sku, item])
    );
    
    return stockData.map(stock => ({
      ...stock,
      turnover: turnoverMap.get(stock.sku)
    }));
  }
  
  private analyzeEfficiency(combinedData: any[]) {
    const warehouseStats = new Map();
    
    combinedData.forEach(item => {
      const warehouse = item.warehouse_name;
      const turnover = item.turnover;
      
      if (!warehouseStats.has(warehouse)) {
        warehouseStats.set(warehouse, {
          name: warehouse,
          totalItems: 0,
          totalStock: 0,
          totalReserved: 0,
          totalPromised: 0,
          fastMovingItems: 0,
          slowMovingItems: 0,
          noSalesItems: 0,
          averageDaysLeft: 0,
          efficiency: 0
        });
      }
      
      const stats = warehouseStats.get(warehouse);
      stats.totalItems++;
      stats.totalStock += item.free_to_sell_amount || 0;
      stats.totalReserved += item.reserved_amount || 0;
      stats.totalPromised += item.promised_amount || 0;
      
      if (turnover) {
        const daysLeft = turnover.idc || 0;
        
        if (daysLeft <= 7) {
          stats.fastMovingItems++;
        } else if (daysLeft > 30) {
          stats.slowMovingItems++;
        }
        
        if (turnover.idc_grade === 'GRADES_NOSALES') {
          stats.noSalesItems++;
        }
        
        stats.averageDaysLeft += daysLeft;
      }
    });
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ —Å–∫–ª–∞–¥–∞
    warehouseStats.forEach(stats => {
      if (stats.totalItems > 0) {
        stats.averageDaysLeft = stats.averageDaysLeft / stats.totalItems;
        
        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (0-100)
        const fastMovingRatio = stats.fastMovingItems / stats.totalItems;
        const slowMovingRatio = stats.slowMovingItems / stats.totalItems;
        const utilizationRatio = stats.totalStock / (stats.totalStock + stats.totalReserved + 1);
        
        stats.efficiency = Math.round(
          (fastMovingRatio * 40 + (1 - slowMovingRatio) * 30 + utilizationRatio * 30) * 100
        );
      }
    });
    
    return Array.from(warehouseStats.values());
  }
  
  private generateOptimizationRecommendations(efficiency: any[]) {
    const recommendations = {
      timestamp: new Date().toISOString(),
      warehouseRanking: efficiency.sort((a, b) => b.efficiency - a.efficiency),
      actions: [] as any[],
      summary: {
        totalWarehouses: efficiency.length,
        bestWarehouse: '',
        worstWarehouse: '',
        averageEfficiency: 0
      }
    };
    
    if (efficiency.length > 0) {
      recommendations.summary.bestWarehouse = efficiency[0].name;
      recommendations.summary.worstWarehouse = efficiency[efficiency.length - 1].name;
      recommendations.summary.averageEfficiency = Math.round(
        efficiency.reduce((sum, w) => sum + w.efficiency, 0) / efficiency.length
      );
    }
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∫–ª–∞–¥–∞
    efficiency.forEach(warehouse => {
      if (warehouse.efficiency < 50) {
        recommendations.actions.push({
          warehouse: warehouse.name,
          type: 'OPTIMIZATION_NEEDED',
          priority: 'HIGH',
          issues: [
            warehouse.slowMovingItems > warehouse.totalItems * 0.3 && '–ú–Ω–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–æ –¥–≤–∏–∂—É—â–∏—Ö—Å—è —Ç–æ–≤–∞—Ä–æ–≤',
            warehouse.noSalesItems > warehouse.totalItems * 0.2 && '–ú–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –ø—Ä–æ–¥–∞–∂',
            warehouse.totalReserved > warehouse.totalStock * 0.5 && '–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–µ–∑–µ—Ä–≤–æ–≤'
          ].filter(Boolean),
          recommendations: [
            '–ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ –¥–≤–∏–∂—É—â–∏–µ—Å—è —Ç–æ–≤–∞—Ä—ã',
            '–ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –ø—Ä–æ–¥–∞–∂',
            '–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è'
          ]
        });
      } else if (warehouse.efficiency > 80) {
        recommendations.actions.push({
          warehouse: warehouse.name,
          type: 'BEST_PRACTICE',
          priority: 'LOW',
          message: '–í—ã—Å–æ–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –æ–±—Ä–∞–∑–µ—Ü'
        });
      }
    });
    
    return recommendations;
  }
  
  private delay(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}
```

---

## üìù TypeScript —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ Request –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
// –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤
interface AnalyticsTurnoverStocksRequest {
  limit?: number;    // 1-1000, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –æ—Ç–≤–µ—Ç–µ
  offset?: number;   // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã
  sku?: string[];    // SKU –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (int64 –∫–∞–∫ string)
}

// –û—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö (deprecated)
interface AnalyticsStockOnWarehouseRequest {
  limit: number;     // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)
  offset?: number;   // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  warehouse_type?: WarehouseType;
}

type WarehouseType = 'ALL' | 'FBO' | 'FBS' | 'CROSSDOCK';
```

### Response –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
// –û—Ç–≤–µ—Ç –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏
interface AnalyticsTurnoverStocksResponse {
  items?: TurnoverItem[];
}

interface TurnoverItem {
  ads?: number;           // –°—Ä–µ–¥–Ω–µ—Å—É—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ 60 –¥–Ω–µ–π
  current_stock?: number; // –û—Å—Ç–∞—Ç–æ–∫ —Ç–æ–≤–∞—Ä–∞, —à—Ç.
  idc?: number;          // –ù–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Ö–≤–∞—Ç–∏—Ç –æ—Å—Ç–∞—Ç–∫–∞
  idc_grade?: StockGrade; // –£—Ä–æ–≤–µ–Ω—å –æ—Å—Ç–∞—Ç–∫–∞
  name?: string;         // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  offer_id?: string;     // –ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞
  sku?: number;          // SKU —Ç–æ–≤–∞—Ä–∞ –≤ —Å–∏—Å—Ç–µ–º–µ OZON
  turnover?: number;     // –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å –≤ –¥–Ω—è—Ö
  turnover_grade?: StockGrade; // –£—Ä–æ–≤–µ–Ω—å –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏
}

type StockGrade = 
  | 'GRADES_NONE'      // –û–∂–∏–¥–∞—é—Ç—Å—è –ø–æ—Å—Ç–∞–≤–∫–∏
  | 'GRADES_NOSALES'   // –ù–µ—Ç –ø—Ä–æ–¥–∞–∂
  | 'GRADES_GREEN'     // –ó–µ–ª—ë–Ω—ã–π, ¬´—Ö–æ—Ä–æ—à–∏–π¬ª
  | 'GRADES_YELLOW'    // –ñ—ë–ª—Ç—ã–π, ¬´—Å—Ä–µ–¥–Ω–∏–π¬ª
  | 'GRADES_RED'       // –ö—Ä–∞—Å–Ω—ã–π, ¬´–ø–ª–æ—Ö–æ–π¬ª
  | 'GRADES_CRITICAL'; // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

// –û—Ç–≤–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö
interface AnalyticsStockOnWarehouseResponse {
  result?: {
    rows?: StockWarehouseRow[];
  };
}

interface StockWarehouseRow {
  sku?: number;                // SKU —Ç–æ–≤–∞—Ä–∞
  item_code?: string;          // –ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞
  item_name?: string;          // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  free_to_sell_amount?: number; // –î–æ—Å—Ç—É–ø–Ω–æ –∫ –ø—Ä–æ–¥–∞–∂–µ
  promised_amount?: number;     // –û–∂–∏–¥–∞–µ—Ç—Å—è –≤ –ø–æ—Å—Ç–∞–≤–∫–∞—Ö
  reserved_amount?: number;     // –í —Ä–µ–∑–µ—Ä–≤–µ
  warehouse_name?: string;      // –ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–ª–∞–¥–∞
}
```

---

## üö® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ API –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### Rate Limiting - –ö–†–ò–¢–ò–ß–ù–û –≤–∞–∂–Ω–æ! ‚ö†Ô∏è
- **–û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤**: –ú–∞–∫—Å–∏–º—É–º **1 –∑–∞–ø—Ä–æ—Å –≤ –º–∏–Ω—É—Ç—É** –Ω–∞ –æ–¥–∏–Ω Client-Id
- **–û—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã OZON API

‚ö†Ô∏è **–ù–∞—Ä—É—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ API!**

```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞
async function getTurnoverSafely() {
  console.log('üìä –ó–∞–ø—Ä–æ—Å –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏...');
  
  const result = await client.analytics.getStocksTurnover({
    limit: 1000,
    offset: 0
  });
  
  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 61 —Å–µ–∫—É–Ω–¥–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
  console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ 61 —Å–µ–∫—É–Ω–¥—É –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞...');
  await new Promise(resolve => setTimeout(resolve, 61000));
  
  return result;
}

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞
async function getTurnoverIncorrect() {
  const batch1 = await client.analytics.getStocksTurnover({ limit: 500, offset: 0 });
  const batch2 = await client.analytics.getStocksTurnover({ limit: 500, offset: 500 }); // ‚ùå –ó–∞–±–ª–æ–∫–∏—Ä—É—é—Ç!
}
```

### –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –º–µ—Ç–æ–¥—ã
‚ö†Ô∏è **–ú–µ—Ç–æ–¥ `getStockOnWarehouses` –±—É–¥–µ—Ç –æ—Ç–∫–ª—é—á—ë–Ω** - –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –Ω–∞ `/v1/analytics/stocks`

### –û—Ç–ª–∏—á–∏—è –æ—Ç –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –û—Ç—á—ë—Ç `getStockOnWarehouses` –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ—Ç—á—ë—Ç–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Üí –û—Ç—á—ë—Ç—ã ‚Üí –û—Ç—á—ë—Ç –ø–æ –æ—Å—Ç–∞—Ç–∫–∞–º –∏ —Ç–æ–≤–∞—Ä–∞–º –≤ –ø—É—Ç–∏ –Ω–∞ —Å–∫–ª–∞–¥—ã Ozon** –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ.

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ SKU
```typescript
// ‚úÖ –ï—Å–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–æ SKU
const specificItems = await client.analytics.getStocksTurnover({
  sku: ['12345', '67890', '11111'] // limit –∏ offset –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
});

// ‚úÖ –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–≥–∏–Ω–∞—Ü–∏—é
const allItems = await client.analytics.getStocksTurnover({
  limit: 1000, // –ú–∞–∫—Å–∏–º—É–º –∑–∞ —Ä–∞–∑
  offset: 0
});
```

---

## üí° –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –°–æ–±–ª—é–¥–µ–Ω–∏–µ Rate Limiting
```typescript
class AnalyticsRateLimiter {
  private lastTurnoverRequest = 0;
  private readonly TURNOVER_COOLDOWN = 61000; // 61 —Å–µ–∫—É–Ω–¥–∞
  
  async getTurnoverWithRateLimit(request: any) {
    const now = Date.now();
    const timeSinceLastRequest = now - this.lastTurnoverRequest;
    
    if (timeSinceLastRequest < this.TURNOVER_COOLDOWN) {
      const waitTime = this.TURNOVER_COOLDOWN - timeSinceLastRequest;
      console.log(`‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ ${Math.ceil(waitTime / 1000)} —Å–µ–∫—É–Ω–¥...`);
      await new Promise(resolve => setTimeout(resolve, waitTime));
    }
    
    try {
      const result = await client.analytics.getStocksTurnover(request);
      this.lastTurnoverRequest = Date.now();
      
      console.log('‚úÖ –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');
      return result;
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
      throw error;
    }
  }
}
```

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
```typescript
class AnalyticsCache {
  private turnoverCache = new Map<string, { data: any; timestamp: number }>();
  private readonly CACHE_TTL = 6 * 60 * 60 * 1000; // 6 —á–∞—Å–æ–≤
  
  async getCachedTurnover(request: any) {
    const cacheKey = JSON.stringify(request);
    const cached = this.turnoverCache.get(cacheKey);
    
    if (cached && (Date.now() - cached.timestamp) < this.CACHE_TTL) {
      console.log('üìã –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –∫—ç—à–∞');
      return cached.data;
    }
    
    console.log('üîÑ –ó–∞–ø—Ä–æ—Å —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö...');
    const data = await client.analytics.getStocksTurnover(request);
    
    this.turnoverCache.set(cacheKey, {
      data,
      timestamp: Date.now()
    });
    
    return data;
  }
  
  clearCache() {
    this.turnoverCache.clear();
    console.log('üóëÔ∏è –ö—ç—à –æ—á–∏—â–µ–Ω');
  }
}
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏
```typescript
class TurnoverMetrics {
  calculateMetrics(items: TurnoverItem[]) {
    const metrics = {
      totalItems: items.length,
      averageTurnover: 0,
      averageDaysLeft: 0,
      gradeDistribution: {
        critical: 0,
        red: 0,
        yellow: 0,
        green: 0,
        noSales: 0,
        none: 0
      },
      topSlowMoving: [] as any[],
      topFastMoving: [] as any[]
    };
    
    let totalTurnover = 0;
    let totalDaysLeft = 0;
    let itemsWithData = 0;
    
    items.forEach(item => {
      // –ü–æ–¥—Å—á—ë—Ç –ø–æ —É—Ä–æ–≤–Ω—è–º
      switch (item.idc_grade) {
        case 'GRADES_CRITICAL': metrics.gradeDistribution.critical++; break;
        case 'GRADES_RED': metrics.gradeDistribution.red++; break;
        case 'GRADES_YELLOW': metrics.gradeDistribution.yellow++; break;
        case 'GRADES_GREEN': metrics.gradeDistribution.green++; break;
        case 'GRADES_NOSALES': metrics.gradeDistribution.noSales++; break;
        default: metrics.gradeDistribution.none++; break;
      }
      
      // –°—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
      if (item.turnover && item.turnover > 0) {
        totalTurnover += item.turnover;
        itemsWithData++;
      }
      
      if (item.idc && item.idc > 0) {
        totalDaysLeft += item.idc;
      }
    });
    
    if (itemsWithData > 0) {
      metrics.averageTurnover = totalTurnover / itemsWithData;
      metrics.averageDaysLeft = totalDaysLeft / itemsWithData;
    }
    
    // –¢–æ–ø –º–µ–¥–ª–µ–Ω–Ω–æ –¥–≤–∏–∂—É—â–∏—Ö—Å—è —Ç–æ–≤–∞—Ä–æ–≤
    metrics.topSlowMoving = items
      .filter(item => item.turnover && item.turnover > 0)
      .sort((a, b) => (b.turnover || 0) - (a.turnover || 0))
      .slice(0, 10)
      .map(item => ({
        name: item.name,
        offer_id: item.offer_id,
        turnover: item.turnover,
        current_stock: item.current_stock
      }));
    
    // –¢–æ–ø –±—ã—Å—Ç—Ä–æ –¥–≤–∏–∂—É—â–∏—Ö—Å—è —Ç–æ–≤–∞—Ä–æ–≤
    metrics.topFastMoving = items
      .filter(item => item.turnover && item.turnover > 0)
      .sort((a, b) => (a.turnover || 0) - (b.turnover || 0))
      .slice(0, 10)
      .map(item => ({
        name: item.name,
        offer_id: item.offer_id,
        turnover: item.turnover,
        ads: item.ads
      }));
    
    return metrics;
  }
  
  generateReport(metrics: any) {
    console.log('\nüìä –û–¢–ß–Å–¢ –ü–û –û–ë–û–†–ê–ß–ò–í–ê–ï–ú–û–°–¢–ò');
    console.log('============================');
    
    console.log(`üì¶ –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: ${metrics.totalItems}`);
    console.log(`‚è±Ô∏è –°—Ä–µ–¥–Ω—è—è –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å: ${metrics.averageTurnover.toFixed(1)} –¥–Ω–µ–π`);
    console.log(`üìÖ –°—Ä–µ–¥–Ω–∏–π –∑–∞–ø–∞—Å: ${metrics.averageDaysLeft.toFixed(1)} –¥–Ω–µ–π`);
    
    console.log('\nüéØ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º:');
    console.log(`üÜò –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π: ${metrics.gradeDistribution.critical} —Ç–æ–≤–∞—Ä–æ–≤`);
    console.log(`üî¥ –ö—Ä–∞—Å–Ω—ã–π: ${metrics.gradeDistribution.red} —Ç–æ–≤–∞—Ä–æ–≤`);
    console.log(`üü° –ñ—ë–ª—Ç—ã–π: ${metrics.gradeDistribution.yellow} —Ç–æ–≤–∞—Ä–æ–≤`);
    console.log(`üü¢ –ó–µ–ª—ë–Ω—ã–π: ${metrics.gradeDistribution.green} —Ç–æ–≤–∞—Ä–æ–≤`);
    console.log(`‚ö™ –ë–µ–∑ –ø—Ä–æ–¥–∞–∂: ${metrics.gradeDistribution.noSales} —Ç–æ–≤–∞—Ä–æ–≤`);
    
    if (metrics.topSlowMoving.length > 0) {
      console.log('\nüêå –¢–æ–ø –º–µ–¥–ª–µ–Ω–Ω–æ –¥–≤–∏–∂—É—â–∏—Ö—Å—è —Ç–æ–≤–∞—Ä–æ–≤:');
      metrics.topSlowMoving.forEach((item: any, index: number) => {
        console.log(`  ${index + 1}. ${item.name} - ${item.turnover.toFixed(1)} –¥–Ω–µ–π`);
      });
    }
    
    if (metrics.topFastMoving.length > 0) {
      console.log('\nüöÄ –¢–æ–ø –±—ã—Å—Ç—Ä–æ –¥–≤–∏–∂—É—â–∏—Ö—Å—è —Ç–æ–≤–∞—Ä–æ–≤:');
      metrics.topFastMoving.forEach((item: any, index: number) => {
        console.log(`  ${index + 1}. ${item.name} - ${item.turnover.toFixed(1)} –¥–Ω–µ–π (${item.ads?.toFixed(1)} —à—Ç/–¥–µ–Ω—å)`);
      });
    }
  }
}
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ API

- **[Products API](./products.md)** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- **[Warehouse API](./warehouse.md)** ‚Äî –¥–∞–Ω–Ω—ã–µ –æ —Å–∫–ª–∞–¥–∞—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- **[Finance API](./finance.md)** ‚Äî —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- **[FBO API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî —Ç–æ–≤–∞—Ä—ã FBO
- **[FBS API](https://github.com/salacoste/ozon-daytona-seller-api)** ‚Äî —Ç–æ–≤–∞—Ä—ã FBS

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–ù–∞—à–ª–∏ –æ—à–∏–±–∫—É –∏–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–ª—É—á—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é?**
- üêõ [–°–æ–∑–¥–∞—Ç—å Issue](https://github.com/salacoste/ozon-daytona-seller-api/issues/new)
- üîß [Pull Request](https://github.com/salacoste/ozon-daytona-seller-api/compare)
- üí¨ [GitHub Discussions](https://github.com/salacoste/ozon-daytona-seller-api/discussions)

**–ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:**
- üìö [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è OZON](https://docs.ozon.ru/api/seller/)
- ‚≠ê [–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π SDK](https://github.com/salacoste/ozon-daytona-seller-api)
- üì¶ [NPM –ø–∞–∫–µ—Ç](https://www.npmjs.com/package/daytona-ozon-seller-api)
- üè™ [FBO -> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞–º–∏](https://seller.ozon.ru/app/supply/stocks-management) –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

---

üè† [–ì–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../README.md) | üìö [–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏](./README.md)
```